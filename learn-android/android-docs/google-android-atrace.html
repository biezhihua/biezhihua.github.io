<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.74" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://github.com/biezhihua/learn-android/android-docs/google-android-atrace.html"><meta property="og:site_name" content="biezhihua的日常"><meta property="og:title" content="Android | Docs | google-android-atrace"><meta property="og:description" content="Android | Docs | google-android-atrace > 体系化的为我讲解atrace的作用、源码、实现原理、使用方法、注意事项等 atrace（Android Trace）是一个用于分析Android系统性能的工具。它通过收集内核中的跟踪数据，帮助开发者了解系统中的各种事件（如CPU调度、内存分配、同步原语等）的执行情况，从而..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-03-08T14:25:34.000Z"><meta property="article:tag" content="android"><meta property="article:tag" content="google-docs"><meta property="article:modified_time" content="2025-03-08T14:25:34.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Android | Docs | google-android-atrace","image":[""],"dateModified":"2025-03-08T14:25:34.000Z","author":[{"@type":"Person","name":"别志华","url":"https://github.com/biezhihua"}]}</script><title>Android | Docs | google-android-atrace | biezhihua的日常</title><meta name="description" content="Android | Docs | google-android-atrace > 体系化的为我讲解atrace的作用、源码、实现原理、使用方法、注意事项等 atrace（Android Trace）是一个用于分析Android系统性能的工具。它通过收集内核中的跟踪数据，帮助开发者了解系统中的各种事件（如CPU调度、内存分配、同步原语等）的执行情况，从而...">
    <link rel="preload" href="/assets/style-Dh4i2S4S.css" as="style"><link rel="stylesheet" href="/assets/style-Dh4i2S4S.css">
    <link rel="modulepreload" href="/assets/app-CeWOgC-6.js"><link rel="modulepreload" href="/assets/google-android-atrace.html-d9DWYIvQ.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-1dX4RJIv.js" as="script"><link rel="prefetch" href="/assets/about-me.html-CkTu1bVz.js" as="script"><link rel="prefetch" href="/assets/index.html-BxZGU23K.js" as="script"><link rel="prefetch" href="/assets/index.html-BtDGtSYr.js" as="script"><link rel="prefetch" href="/assets/index.html-DFGgcgLb.js" as="script"><link rel="prefetch" href="/assets/difficult-sentence.html-CIuD4mzZ.js" as="script"><link rel="prefetch" href="/assets/Algorithms-analysis.html-DRw_u1hs.js" as="script"><link rel="prefetch" href="/assets/Algorithms-apply.html-CzKQ0HEh.js" as="script"><link rel="prefetch" href="/assets/Algorithms-math-base.html-DpymYhgO.js" as="script"><link rel="prefetch" href="/assets/Algorithms-thinking.html-Jc-1j3fq.js" as="script"><link rel="prefetch" href="/assets/Algorithms.html-BA-EGN2H.js" as="script"><link rel="prefetch" href="/assets/Data-structure.html-BLbQjGhr.js" as="script"><link rel="prefetch" href="/assets/index.html-C1Hxa4Wn.js" as="script"><link rel="prefetch" href="/assets/algorithms-graph.html-By-8xsc7.js" as="script"><link rel="prefetch" href="/assets/android-逆向学习.html-CFxLnsDf.js" as="script"><link rel="prefetch" href="/assets/滴水三期.html-CFBdyjC5.js" as="script"><link rel="prefetch" href="/assets/计算机组成原理.html-CLGJDhOL.js" as="script"><link rel="prefetch" href="/assets/Assembly-Language-4th-Edition-Wang-Shuang.html-Dut2ouOd.js" as="script"><link rel="prefetch" href="/assets/Learn-Reverse-Engineering.html-CHORrCQv.js" as="script"><link rel="prefetch" href="/assets/SELinux.html-D8RO3F23.js" as="script"><link rel="prefetch" href="/assets/The-Self-cultivation-of-Programmers-Linking-Loading-and-Libraries.html-BveY31-P.js" as="script"><link rel="prefetch" href="/assets/The-core-principles-of-reverse-engineering.html-LOOhsoTC.js" as="script"><link rel="prefetch" href="/assets/andorid-kernel.html-B7AcJqiC.js" as="script"><link rel="prefetch" href="/assets/android-aar-maven.html-83e1hrsc.js" as="script"><link rel="prefetch" href="/assets/android-immersive.html-CG2pAbmR.js" as="script"><link rel="prefetch" href="/assets/android-ndk-r18b-toolchains.html-D0R0EhwJ.js" as="script"><link rel="prefetch" href="/assets/android-notification-listener-service.html-C3nz0vf7.js" as="script"><link rel="prefetch" href="/assets/android-scrcpy.html-cU5ClmOc.js" as="script"><link rel="prefetch" href="/assets/binary-and-hexadecimal-conversion-rules.html-Dnq2aS9Q.js" as="script"><link rel="prefetch" href="/assets/color-difference-calculation.html-CyuDQRKn.js" as="script"><link rel="prefetch" href="/assets/color.html-CjaQgHEP.js" as="script"><link rel="prefetch" href="/assets/gradle-commonh-command.html-CzhwCHJ8.js" as="script"><link rel="prefetch" href="/assets/how-to-call-rust-function-from-harmony.html-D_XrfLy2.js" as="script"><link rel="prefetch" href="/assets/how-to-extension-method-for-option-in-rust.html-gGF1uSkr.js" as="script"><link rel="prefetch" href="/assets/how-to-fix-waiting-for-file-lock-on-package-cache.html-BYdb9nSn.js" as="script"><link rel="prefetch" href="/assets/how-to-get-multi-option-value.html-BEeiRI_k.js" as="script"><link rel="prefetch" href="/assets/how-to-ignore-warning-info-in-rust.html-BM9uMpzV.js" as="script"><link rel="prefetch" href="/assets/how-to-mount-remote-disk-to-local.html-NEa1eULy.js" as="script"><link rel="prefetch" href="/assets/how-to-process-common-error.html-DgMfPaUf.js" as="script"><link rel="prefetch" href="/assets/how-to-read-config-file-of-lib-project-in-rust.html-MmrbTEZq.js" as="script"><link rel="prefetch" href="/assets/how-to-use-result-process-option-in-rust.html-9iKJiXvt.js" as="script"><link rel="prefetch" href="/assets/hypervisor.html-BYIOjF75.js" as="script"><link rel="prefetch" href="/assets/learn-compilers.html-DfHiI7KY.js" as="script"><link rel="prefetch" href="/assets/learn-ida.html-BzeeSSKE.js" as="script"><link rel="prefetch" href="/assets/learn-rust.html-DivWpi8B.js" as="script"><link rel="prefetch" href="/assets/learn-stable-diffusion.html-Cnx8YMWg.js" as="script"><link rel="prefetch" href="/assets/learn-ui-design-UI设计必修课-交互-架构-视觉UI设计教程.html-BdgDRgyx.js" as="script"><link rel="prefetch" href="/assets/learn-windows-linux.html-EWKvdP7x.js" as="script"><link rel="prefetch" href="/assets/lr1-detail.html-sZjEgonB.js" as="script"><link rel="prefetch" href="/assets/lr1-detail2.html-BtQXzI5g.js" as="script"><link rel="prefetch" href="/assets/lr1-detail3.html-Ctt81v2m.js" as="script"><link rel="prefetch" href="/assets/lr1-detail4.html-o5UmR9Fv.js" as="script"><link rel="prefetch" href="/assets/lr1-产生式是如何定义的.html-DBJnMpkd.js" as="script"><link rel="prefetch" href="/assets/lr1.html-ruDVc0-n.js" as="script"><link rel="prefetch" href="/assets/math-lerp.html-Ct_YJieM.js" as="script"><link rel="prefetch" href="/assets/mhxy-navgiate-mode.html-NyHcSsF9.js" as="script"><link rel="prefetch" href="/assets/mhxy-script.html-DJC0Jcc6.js" as="script"><link rel="prefetch" href="/assets/pc-platform-arch-info.html-CkifxkwT.js" as="script"><link rel="prefetch" href="/assets/pyhont-callable.html-B4s6m0ww.js" as="script"><link rel="prefetch" href="/assets/python-async-await-threading.html--vYJxrPD.js" as="script"><link rel="prefetch" href="/assets/python-async-await.html-D56NC_Vv.js" as="script"><link rel="prefetch" href="/assets/python-async-block-unblock.html-7kuphDlb.js" as="script"><link rel="prefetch" href="/assets/python-async.html-2hsnSqur.js" as="script"><link rel="prefetch" href="/assets/python-dict.html-BwiGLf4k.js" as="script"><link rel="prefetch" href="/assets/python-singleton-decorator.html-CaP2PKgm.js" as="script"><link rel="prefetch" href="/assets/python-singleton.html-Cnr6Lwb7.js" as="script"><link rel="prefetch" href="/assets/pythopn-opencv-hist.html-Cb288mev.js" as="script"><link rel="prefetch" href="/assets/quickjs-eval-flags.html-C-AkXDvL.js" as="script"><link rel="prefetch" href="/assets/quickjs-eval.html-DJkpgK8W.js" as="script"><link rel="prefetch" href="/assets/reverse-engineering-1.html-CI-cC0oR.js" as="script"><link rel="prefetch" href="/assets/reverse-engineering-2.html-D0QsNJ1a.js" as="script"><link rel="prefetch" href="/assets/reverse-engineering-3.html-Bi6AfM1I.js" as="script"><link rel="prefetch" href="/assets/reverse-engineering-windows-1.html-l1y_Vf5N.js" as="script"><link rel="prefetch" href="/assets/reverse-engineering-windows-2.html-CivezwaN.js" as="script"><link rel="prefetch" href="/assets/root-magisk-xposed-lsposed.html-Cq8UecFK.js" as="script"><link rel="prefetch" href="/assets/solution-rust-diesel-install-in-windows.html-DQoXDx0-.js" as="script"><link rel="prefetch" href="/assets/using-opencv-4-surf-algorithm-feature-detection-quoc-bao-nguyen.html-96B5HeOS.js" as="script"><link rel="prefetch" href="/assets/vm1.html-Ceitxz1g.js" as="script"><link rel="prefetch" href="/assets/vm2.html-CmI3QMEH.js" as="script"><link rel="prefetch" href="/assets/vm3.html-C4qw-Br-.js" as="script"><link rel="prefetch" href="/assets/vm4.html-DjUwIlV1.js" as="script"><link rel="prefetch" href="/assets/vmx.html-Be4NmRG_.js" as="script"><link rel="prefetch" href="/assets/what-is-the-COM-in-windows.html-8qau_b5K.js" as="script"><link rel="prefetch" href="/assets/what-is-the-epoll.html-pDXGkI1r.js" as="script"><link rel="prefetch" href="/assets/what-is-the-file-descriptor.html-CtfUmIvV.js" as="script"><link rel="prefetch" href="/assets/what-is-the-meaning-of-__no_mangle_.html-CN68znqW.js" as="script"><link rel="prefetch" href="/assets/what-is-the-meaning-of-__repr(C)_.html-B6DNVGUG.js" as="script"><link rel="prefetch" href="/assets/what-is-the-varargs-in-python.html-CgBxYmih.js" as="script"><link rel="prefetch" href="/assets/what-the-different-self-and-Self-in-Rust.html-6owSXlLg.js" as="script"><link rel="prefetch" href="/assets/windows-SystemFirmwareTable.html-DNkd25JS.js" as="script"><link rel="prefetch" href="/assets/windows-dev.html-ByTtlnM0.js" as="script"><link rel="prefetch" href="/assets/google-android-graphics.html-C4GVsiSQ.js" as="script"><link rel="prefetch" href="/assets/google-android-performance-overview.html-DchMXUtj.js" as="script"><link rel="prefetch" href="/assets/google-android-profiler.html-Dct2DpQj.js" as="script"><link rel="prefetch" href="/assets/google-android-system.html-tqgrK3tG.js" as="script"><link rel="prefetch" href="/assets/app-launch.html-AYJBWNGn.js" as="script"><link rel="prefetch" href="/assets/build-aosp-in-wls.html-DaM3N4g5.js" as="script"><link rel="prefetch" href="/assets/extend.html-BgPAV5TL.js" as="script"><link rel="prefetch" href="/assets/surfaceflinger-init.html-CouDAqBJ.js" as="script"><link rel="prefetch" href="/assets/surfaceflinger-vsync.html-BYQP3_E4.js" as="script"><link rel="prefetch" href="/assets/zygote.html-BJRfuMzz.js" as="script"><link rel="prefetch" href="/assets/perfetto-00-outline.html-BWiuFxLg.js" as="script"><link rel="prefetch" href="/assets/perfetto-01-overview.html-CO4fjwr7.js" as="script"><link rel="prefetch" href="/assets/perfetto-02-tracing-101.html-Bnne8WQK.js" as="script"><link rel="prefetch" href="/assets/perfetto-03-quickstart-record-traces-on-android.html-ClEZvD5z.js" as="script"><link rel="prefetch" href="/assets/perfetto-06-quickstart-sql-analysis-and-metrics copy.html-PtrrKJm0.js" as="script"><link rel="prefetch" href="/assets/perfetto-07-quickstart-trace-conversion copy.html-CXClV3hP.js" as="script"><link rel="prefetch" href="/assets/perfetto-08-quickstart-heap-profiling copy.html-1buI7HFB.js" as="script"><link rel="prefetch" href="/assets/perfetto-09-quickstart-callstack-sampling-on-android copy.html-C41q37-S.js" as="script"><link rel="prefetch" href="/assets/perfetto-10-faq.html-Dp9Yoc8Z.js" as="script"><link rel="prefetch" href="/assets/perfetto-11-case-stuides-android-boot-tracing.html-BCe4Is59.js" as="script"><link rel="prefetch" href="/assets/perfetto-12-data-sources-debugging-memory-usage.html-BsJrVrB2.js" as="script"><link rel="prefetch" href="/assets/perfetto-13-data-sources-memory-counter-and-events.html-DsbPYSvd.js" as="script"><link rel="prefetch" href="/assets/perfetto-14-data-sources-memory-heap-profiler.html-HEiokN8b.js" as="script"><link rel="prefetch" href="/assets/perfetto-15-data-sources-java-heap-dumps.html-dzZaMZsO.js" as="script"><link rel="prefetch" href="/assets/perfetto-16-data-sources-cpu-scheduling-events.html-Db4BbQkd.js" as="script"><link rel="prefetch" href="/assets/perfetto-17-data-sources-system-calls.html-DkgknR64.js" as="script"><link rel="prefetch" href="/assets/perfetto-18-data-sources-cpu-frequency-scaling.html-C6KpLaAN.js" as="script"><link rel="prefetch" href="/assets/perfetto-21-android-system-android-game-intervention-list.html-K0pUPK0-.js" as="script"><link rel="prefetch" href="/assets/perfetto-22-data-sources-android-system-atrace-instrumentation.html-DNOkdk5d.js" as="script"><link rel="prefetch" href="/assets/perfetto-23-data-sources-android-system-android-log.html-BJQG8DXD.js" as="script"><link rel="prefetch" href="/assets/perfetto-24-data-sources-android-system-android-jank.html-CqzmQ45c.js" as="script"><link rel="prefetch" href="/assets/perfetto-25-app-instrumentation-tracing-sdk.html-B9N7bLGt.js" as="script"><link rel="prefetch" href="/assets/perfetto-28-trace-analysis-trace-processor.html-bE4Yf2Gr.js" as="script"><link rel="prefetch" href="/assets/perfetto-41-core-concepts-trace-configuration.html-CrQXlXCO.js" as="script"><link rel="prefetch" href="/assets/perfetto-42-core-concepts-buffers-and-dataflow.html-DTzGtuu-.js" as="script"><link rel="prefetch" href="/assets/perfetto-43-core-concepts-service-model.html-DSOyiZWu.js" as="script"><link rel="prefetch" href="/assets/fluency-00-outline.html-BpJf1lnd.js" as="script"><link rel="prefetch" href="/assets/fluency-01-overview.html-W4YI33td.js" as="script"><link rel="prefetch" href="/assets/fluency-02-fps.html-CrU-abVp.js" as="script"><link rel="prefetch" href="/assets/fluency-03-observability-technology.html-B9m9FSd6.js" as="script"><link rel="prefetch" href="/assets/fluency-04-tracing.html-DqDTTu1L.js" as="script"><link rel="prefetch" href="/assets/fluency-05-tools-perfetto.html-CNmCVT6X.js" as="script"><link rel="prefetch" href="/assets/fluency-06-tools-android-profiler.html-fGMVU68e.js" as="script"><link rel="prefetch" href="/assets/fluency-07-perfetto-android-overview.html-Dp4CwRcn.js" as="script"><link rel="prefetch" href="/assets/fluency-08-perfetto-android-graphics-vsync.html-XW4isvO0.js" as="script"><link rel="prefetch" href="/assets/index.html-CUynUsvz.js" as="script"><link rel="prefetch" href="/assets/native-crash.html-M4lZIXe0.js" as="script"><link rel="prefetch" href="/assets/overview.html-fLRpQnGh.js" as="script"><link rel="prefetch" href="/assets/index.html-BFaisX3g.js" as="script"><link rel="prefetch" href="/assets/6.006 Introduction To Algorithms.html-BZXvdF-v.js" as="script"><link rel="prefetch" href="/assets/6.042J Undergraduate Mathematics For Computer Science.html-C90y9ljc.js" as="script"><link rel="prefetch" href="/assets/6.046J Design And Analysis Of Algorithms.html-ChlEG5gq.js" as="script"><link rel="prefetch" href="/assets/6.828 Operating System Engineering.html-BGx84DIw.js" as="script"><link rel="prefetch" href="/assets/6.851 Advanced Data Structures.html-C90vbr6S.js" as="script"><link rel="prefetch" href="/assets/6.854J Advanced Alorithms.html-C7AH3oQp.js" as="script"><link rel="prefetch" href="/assets/Lesson-01-A-private-conversation.html-BjDmSVwT.js" as="script"><link rel="prefetch" href="/assets/Lesson-02-Breakfast-or-lunch.html-BCaib8k-.js" as="script"><link rel="prefetch" href="/assets/Lesson-03-Please-send-me-a-card.html-CDuhJ6Yq.js" as="script"><link rel="prefetch" href="/assets/Lesson-04-An-exciting-trip.html-3rMnVx_j.js" as="script"><link rel="prefetch" href="/assets/Lesson-05-No-Wrong-Numbers.html-DvcxSykG.js" as="script"><link rel="prefetch" href="/assets/Lesson-06-Percy-Buttons.html-J47Sq_2M.js" as="script"><link rel="prefetch" href="/assets/Lesson-07-Too-late.html-CNGRR_eZ.js" as="script"><link rel="prefetch" href="/assets/Lesson-08-The-best-and-the-worst.html-Bn9Ragto.js" as="script"><link rel="prefetch" href="/assets/Lesson-09-A-cold-welcome.html-BGOvWk8C.js" as="script"><link rel="prefetch" href="/assets/Lesson-10-Not-For-Jazz.html-DpDVP3fz.js" as="script"><link rel="prefetch" href="/assets/Lesson-11-One-good-turn-deserves-another.html-jXP_tNW5.js" as="script"><link rel="prefetch" href="/assets/Lesson-12-Goodbye-and-good-luck.html-DMmRt8CW.js" as="script"><link rel="prefetch" href="/assets/Lesson-13-The-Greenwood-Boys.html-DgtaX43x.js" as="script"><link rel="prefetch" href="/assets/Lesson-14-Do-you-speak-English.html-DSIgXROR.js" as="script"><link rel="prefetch" href="/assets/Lesson-15-Good-news.html-6yIHUkCj.js" as="script"><link rel="prefetch" href="/assets/Lesson-16-A-polite-request.html-QsQUXuQn.js" as="script"><link rel="prefetch" href="/assets/Lesson-17-Always-young.html-DneF0d5k.js" as="script"><link rel="prefetch" href="/assets/Lesson-18-He-often-does-this.html-9-fKMidD.js" as="script"><link rel="prefetch" href="/assets/Lesson-19-Sold-out.html-DIAj1yho.js" as="script"><link rel="prefetch" href="/assets/Lesson-20-One-man-in-a-boat.html-lpHhdXmf.js" as="script"><link rel="prefetch" href="/assets/Lesson-21-Mad-or-not.html-DRszxvlK.js" as="script"><link rel="prefetch" href="/assets/Lesson-22-A-glass-envelope.html-CVGGFnrk.js" as="script"><link rel="prefetch" href="/assets/Lesson-23-A-new-house.html-CDd3lFoj.js" as="script"><link rel="prefetch" href="/assets/Lesson-24-If-could-be-worse.html-4-Y2sgEJ.js" as="script"><link rel="prefetch" href="/assets/Lesson-25-Do-the-English-speak-English.html-DGW5BlvL.js" as="script"><link rel="prefetch" href="/assets/Lesson-26-The-best-art-critics.html-CfWJHVGd.js" as="script"><link rel="prefetch" href="/assets/Lesson-27-A-wet-night.html-ByeMNxEc.js" as="script"><link rel="prefetch" href="/assets/Lesson-28-No-parking.html-D7Yq2p6i.js" as="script"><link rel="prefetch" href="/assets/Lesson-29-Taxi.html-DZk4Q-nM.js" as="script"><link rel="prefetch" href="/assets/Lesson-30-Football-or-polo.html-BJ_ONBzc.js" as="script"><link rel="prefetch" href="/assets/Lesson-31-Success-story.html-CfEXU2an.js" as="script"><link rel="prefetch" href="/assets/Lesson-32-Shopping-make-easy.html-C10Yk3dJ.js" as="script"><link rel="prefetch" href="/assets/Lesson-33-Out-of-the-darkness.html-DBoREquR.js" as="script"><link rel="prefetch" href="/assets/Lesson-34-Quick-work.html-C5Z72cQM.js" as="script"><link rel="prefetch" href="/assets/Lesson-35-Stop-thief.html-J525tzpL.js" as="script"><link rel="prefetch" href="/assets/Lesson-36-Across-the-Channel.html-CmmX7yxT.js" as="script"><link rel="prefetch" href="/assets/Lesson-37-The-Olympic-Games.html-DQEjRCci.js" as="script"><link rel="prefetch" href="/assets/Lesson-38-Everything-except-the-weather.html-D3KJZwzi.js" as="script"><link rel="prefetch" href="/assets/Lesson-39-Am-I-all-right.html-BeWxFkgQ.js" as="script"><link rel="prefetch" href="/assets/Lesson-40-Food-and-talk.html-B9b4JDWQ.js" as="script"><link rel="prefetch" href="/assets/Lesson-41-Do-you-call-that-a-hat.html-BmCGpwwu.js" as="script"><link rel="prefetch" href="/assets/Lesson-42-Not-very-musical.html-DkFn-I2D.js" as="script"><link rel="prefetch" href="/assets/Lesson-43-Over-the-South-Pole.html-Bci20KLn.js" as="script"><link rel="prefetch" href="/assets/Lesson-44-Through-the-forest.html-DIBHVrvh.js" as="script"><link rel="prefetch" href="/assets/Lesson-45-A-clear-conscience.html-BtaEa3D1.js" as="script"><link rel="prefetch" href="/assets/Lesson-46-Expensive-and-uncomfortable.html-CZ5Mposj.js" as="script"><link rel="prefetch" href="/assets/Lesson-47-A-thirsty-ghost.html-sr-zqz4g.js" as="script"><link rel="prefetch" href="/assets/Lesson-48-Did-you-want-to-tell-me-something.html-D4CtaBwl.js" as="script"><link rel="prefetch" href="/assets/Lesson-49-The-end-of-a-dream.html-DlNskvW9.js" as="script"><link rel="prefetch" href="/assets/Lesson-50-Taken-for-a-ride.html-L8mynuLx.js" as="script"><link rel="prefetch" href="/assets/Lesson-51-Reward-for-virtue.html-BogbKqeV.js" as="script"><link rel="prefetch" href="/assets/Lesson-52-A-pretty-carpet.html-D2IApXIy.js" as="script"><link rel="prefetch" href="/assets/Lesson-53-Hot-snake.html-BgWUCSkA.js" as="script"><link rel="prefetch" href="/assets/Lesson-54-Sticky-fingers.html-DjxAIoGP.js" as="script"><link rel="prefetch" href="/assets/Lesson-55-Not-a-gold-mine.html-CTyBcc1w.js" as="script"><link rel="prefetch" href="/assets/Lesson-56-Faster-than-sound.html-DNlBsiHh.js" as="script"><link rel="prefetch" href="/assets/Lesson-57-Can-I-help-you_-madam.html-D1kGPJKC.js" as="script"><link rel="prefetch" href="/assets/Lesson-58-A-blessing-in-disguise.html-D9y0XV-N.js" as="script"><link rel="prefetch" href="/assets/Lesson-59-In-or-out.html-DUmxFgdU.js" as="script"><link rel="prefetch" href="/assets/Lesson-60-The-future.html-DqezXQdt.js" as="script"><link rel="prefetch" href="/assets/Lesson-61-Trouble-with-the-Hubble.html-5oiniJlP.js" as="script"><link rel="prefetch" href="/assets/Lesson-62-After-the-fire.html-DGYt8396.js" as="script"><link rel="prefetch" href="/assets/Lesson-63-She-was-not-amused.html-D6u_WfHp.js" as="script"><link rel="prefetch" href="/assets/Lesson-64-The-Channel-Tunnel.html-B6qtkJhS.js" as="script"><link rel="prefetch" href="/assets/Lesson-65-Jumbo-versus-the-police.html-BeubmxJT.js" as="script"><link rel="prefetch" href="/assets/Lesson-66-Sweet-as-honey.html-CEp6GSib.js" as="script"><link rel="prefetch" href="/assets/Lesson-67-Volcanoes.html-BoE4Zcpr.js" as="script"><link rel="prefetch" href="/assets/Lesson-68-Persistent.html-Ko6ph58m.js" as="script"><link rel="prefetch" href="/assets/Lesson-69-But-not-murder.html-CAgWOaT4.js" as="script"><link rel="prefetch" href="/assets/Lesson-70-Red-for-danger.html-CRB3-WQo.js" as="script"><link rel="prefetch" href="/assets/Lesson-71-A-famous-clock.html-CYc_NH8_.js" as="script"><link rel="prefetch" href="/assets/Lesson-72-A-car-called-bluebird.html-QgnrlrYi.js" as="script"><link rel="prefetch" href="/assets/Lesson-73-The-record-holder.html-CK5V7Zyh.js" as="script"><link rel="prefetch" href="/assets/Lesson-74-Out-of-the-limelight.html-B0_J7gU2.js" as="script"><link rel="prefetch" href="/assets/Lesson-75-SOS.html-w0nkp3-9.js" as="script"><link rel="prefetch" href="/assets/Lesson-76-April-Fools-Day.html-BElFMBff.js" as="script"><link rel="prefetch" href="/assets/Lesson-77-Successful-operation.html-Zo5MV8dD.js" as="script"><link rel="prefetch" href="/assets/Lesson-78-The-last-one.html-Du9ux4Rz.js" as="script"><link rel="prefetch" href="/assets/Lesson-79-By-air.html-CsqUm6Or.js" as="script"><link rel="prefetch" href="/assets/Lesson-80-The-Crystal-Palace.html-DASF07qZ.js" as="script"><link rel="prefetch" href="/assets/Lesson-81-Escape.html-BgMqQX13.js" as="script"><link rel="prefetch" href="/assets/Lesson-82-Monster-or-fish.html-C5G6wMi1.js" as="script"><link rel="prefetch" href="/assets/Lesson-83-After-the-elections.html-Cehh5LUf.js" as="script"><link rel="prefetch" href="/assets/Lesson-84-On-strike.html-tZZHpGpO.js" as="script"><link rel="prefetch" href="/assets/Lesson-85-Never-too-old-to-learn.html-CaKIOMDa.js" as="script"><link rel="prefetch" href="/assets/Lesson-86-Out-of-control.html-lsynMr0z.js" as="script"><link rel="prefetch" href="/assets/Lesson-87-A-perfect-alibi.html-D4VJkH3t.js" as="script"><link rel="prefetch" href="/assets/Lesson-88-Trapped-in-a-mine.html-y-zlxriP.js" as="script"><link rel="prefetch" href="/assets/Lesson-89-A-slip-of-the-tongue.html-CqWiw3W4.js" as="script"><link rel="prefetch" href="/assets/Lesson-90-What-is-for-supper.html-D2euNl4E.js" as="script"><link rel="prefetch" href="/assets/Lesson-91-Three-men-in-a-basket.html-BYMFcaLS.js" as="script"><link rel="prefetch" href="/assets/Lesson-92-Asking-for-trouble.html-AsGYfTti.js" as="script"><link rel="prefetch" href="/assets/Lesson-93-A-noble-gift.html-BF4M7XYQ.js" as="script"><link rel="prefetch" href="/assets/Lesson-94-Future-champions.html-CukT5S_D.js" as="script"><link rel="prefetch" href="/assets/Lesson-95-A-fantasy.html-BkV7tnX8.js" as="script"><link rel="prefetch" href="/assets/Lesson-96-The-dead-return.html-CBqiJKJr.js" as="script"><link rel="prefetch" href="/assets/404.html-Bg5nDn32.js" as="script"><link rel="prefetch" href="/assets/index.html-BVaI_1rb.js" as="script"><link rel="prefetch" href="/assets/index.html-DHEgo8Ko.js" as="script"><link rel="prefetch" href="/assets/index.html-DlldtZzq.js" as="script"><link rel="prefetch" href="/assets/index.html-Bw7PsOPb.js" as="script"><link rel="prefetch" href="/assets/index.html-Dql_gZFh.js" as="script"><link rel="prefetch" href="/assets/index.html-CokTk3AE.js" as="script"><link rel="prefetch" href="/assets/index.html-DP3wbmGJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BnF2jsoU.js" as="script"><link rel="prefetch" href="/assets/index.html-B_oDO7xG.js" as="script"><link rel="prefetch" href="/assets/index.html-AVtzx48M.js" as="script"><link rel="prefetch" href="/assets/index.html-ClON6f93.js" as="script"><link rel="prefetch" href="/assets/index.html-Cms2XJVw.js" as="script"><link rel="prefetch" href="/assets/index.html-27lCxCLm.js" as="script"><link rel="prefetch" href="/assets/index.html-BZnMLx6g.js" as="script"><link rel="prefetch" href="/assets/index.html-FrFZBvP_.js" as="script"><link rel="prefetch" href="/assets/index.html-BGPmrB1u.js" as="script"><link rel="prefetch" href="/assets/index.html-Ch40WVmj.js" as="script"><link rel="prefetch" href="/assets/index.html-BI4sOmDN.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-QXEOFQJV-DC69xxFJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container no-sidebar external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/images/favicon-32x32.png" alt><!----><span class="vp-site-name hide-in-pad">biezhihua的日常</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="LeetCode"><!--[--><!---->LeetCode<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/" aria-label="学习大纲" iconsizing="both"><!---->学习大纲<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Algorithms-analysis.html" aria-label="算法分析" iconsizing="both"><!---->算法分析<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Algorithms-thinking.html" aria-label="算法思想" iconsizing="both"><!---->算法思想<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Algorithms.html" aria-label="算法" iconsizing="both"><!---->算法<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Data-structure.html" aria-label="数据结构" iconsizing="both"><!---->数据结构<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Algorithms-math-base.html" aria-label="数学基础" iconsizing="both"><!---->数学基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-leetcode/Algorithms-apply.html" aria-label="算法应用" iconsizing="both"><!---->算法应用<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="English"><!--[--><!---->English<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-english/" aria-label="学习大纲" iconsizing="both"><!---->学习大纲<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-english/NCE/" aria-label="新概念" iconsizing="both"><!---->新概念<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/learn-english/difficult-sentence.html" aria-label="疑难句分析" iconsizing="both"><!---->疑难句分析<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/about-me.html" aria-label="AboutMe" iconsizing="height"><!---->AboutMe<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Android | Docs | google-android-atrace</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/biezhihua" target="_blank" rel="noopener noreferrer">别志华</a></span><span property="author" content="别志华"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2023年3月28日</span><meta property="datePublished" content="2023-03-28T15:20:50.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 10 分钟</span><meta property="timeRequired" content="PT10M"></span><!----><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3" role>android</span><span class="page-tag-item color8" role>google-docs</span><!--]--><meta property="keywords" content="android,google-docs"></span></div><hr></div><!----><!----><div class="theme-hope-content" vp-content><h1 id="android-docs-google-android-atrace" tabindex="-1"><a class="header-anchor" href="#android-docs-google-android-atrace"><span>Android | Docs | google-android-atrace</span></a></h1><h2 id="体系化的为我讲解atrace的作用、源码、实现原理、使用方法、注意事项等" tabindex="-1"><a class="header-anchor" href="#体系化的为我讲解atrace的作用、源码、实现原理、使用方法、注意事项等"><span>&gt; 体系化的为我讲解atrace的作用、源码、实现原理、使用方法、注意事项等</span></a></h2><p>atrace（Android Trace）是一个用于分析Android系统性能的工具。它通过收集内核中的跟踪数据，帮助开发者了解系统中的各种事件（如CPU调度、内存分配、同步原语等）的执行情况，从而发现性能瓶颈、优化应用程序。</p><p>一、作用</p><ol><li>诊断性能问题：通过分析系统事件，找出性能瓶颈，为性能优化提供依据。</li><li>监控系统运行：了解应用程序在运行时的整体状况，包括CPU使用情况、线程调度等。</li><li>跟踪事件执行：通过可视化工具，可以查看事件执行的顺序，分析事件之间的关联。</li></ol><p>二、源码 atrace的源代码位于AOSP（Android Open Source Project）的<code>system/extra/atrace</code>目录下。主要由C++编写，使用了一些Android系统特性。你可以通过访问Android源代码库来查看atrace的源码：<a href="https://android.googlesource.com/platform/system/extra/+/refs/heads/master/atrace/" target="_blank" rel="noopener noreferrer">https://android.googlesource.com/platform/system/extra/+/refs/heads/master/atrace/</a></p><p>三、实现原理</p><ol><li>atrace通过访问Android内核中的跟踪数据，收集事件信息。这些数据存储在<code>/sys/kernel/debug/tracing</code>目录下。</li><li>atrace使用Ftrace（Function Tracer）内核子系统来收集数据。Ftrace允许在内核中插入探针，记录函数调用和返回信息。</li><li>atrace通过在内核中添加tracepoints（跟踪点）来获取事件信息。tracepoints是内核中特定位置的插入点，允许开发者在运行时插入或移除探针。</li><li>atrace将收集到的跟踪数据以ATRACE_TAG格式输出，可以通过Systrace工具进行可视化分析。</li></ol><p>四、使用方法</p><ol><li>在Android设备上启用atrace：<code>adb shell setprop debug.atrace.tags.enableflags &lt;trace_category&gt;</code></li><li>开始跟踪：<code>adb shell atrace --async_start -t &lt;trace_time&gt; -c &lt;trace_categories&gt;</code></li><li>停止跟踪：<code>adb shell atrace --async_stop</code></li><li>将跟踪数据保存到文件：<code>adb shell atrace --async_dump -o &lt;output_file&gt;</code></li><li>使用Systrace工具进行可视化分析：将输出文件导入Systrace工具。</li></ol><p>五、注意事项</p><ol><li>atrace可能会对系统性能产生一定影响，因此在生产环境中谨慎使用。</li><li>需要使用具有root权限的设备才能完全访问所有功能。</li><li>跟踪数据可能会包含敏感信息，注意保护隐私。</li></ol><p>通过了解atrace的作用、源码、实现原理、使用方法和注意事项，你可以更好地利用这个工具来优化你的Android应用程序。以下是一些建议，可以帮助你更高效地使用atrace：</p><ol><li><p>适时使用：在对应用程序进行性能分析时，使用atrace可以帮助你发现问题和优化点。但在应用程序的正常开发阶段，避免频繁使用atrace，以免影响开发速度。</p></li><li><p>分析重点：针对你的应用程序关注的性能指标，有针对性地选择atrace的跟踪类别。例如，如果你关注CPU使用情况，可以选择“sched”类别；关注内存分配，可以选择“kmem”类别。</p></li><li><p>多次验证：在优化应用程序后，多次使用atrace进行性能验证，以确保优化效果显著并且持久。</p></li><li><p>与其他工具结合：atrace可以与其他Android性能分析工具（如Systrace、Traceview、Perfetto等）结合使用，提供更全面、更深入的性能分析。</p></li><li><p>学习参考：阅读atrace的源码和文档，学习其实现原理和使用技巧，以便更好地运用这个工具。</p></li></ol><p>通过以上建议，你可以更有效地利用atrace来诊断和解决Android应用程序的性能问题。同时，不断学习和实践，掌握更多性能优化技巧，有助于你成为一名优秀的Android开发者。</p><h2 id="深入且详细的分析atrace的源码" tabindex="-1"><a class="header-anchor" href="#深入且详细的分析atrace的源码"><span>&gt; 深入且详细的分析atrace的源码</span></a></h2><p>atrace的源码主要位于AOSP的<code>system/extra/atrace</code>目录下。为了更好地理解atrace的源码，我们可以从以下几个方面进行深入分析：</p><ol><li>源码结构 atrace源码主要包括以下几个文件：</li></ol><ul><li>atrace.cpp：主程序文件，包含main函数。</li><li>atrace.h：头文件，定义了各种数据结构和函数原型。</li><li>util.cpp：实用工具集，包含一些辅助函数。</li></ul><ol start="2"><li><p>main函数 atrace的main函数是程序的入口点。它主要负责解析命令行参数，根据参数执行相应的操作。这些操作包括启动跟踪、停止跟踪、设置跟踪类别等。</p></li><li><p>跟踪类别 atrace支持多种跟踪类别，如CPU调度、内存管理等。源码中定义了一个名为<code>trace_categories</code>的结构体数组，用于存储各种跟踪类别的信息。开发者可以根据需要添加新的跟踪类别。</p></li><li><p>跟踪数据收集 atrace通过访问<code>/sys/kernel/debug/tracing</code>目录下的文件来收集跟踪数据。主要有以下几个步骤：</p></li></ol><ul><li>打开<code>/sys/kernel/debug/tracing/trace_marker</code>文件，用于向内核写入跟踪事件。</li><li>打开<code>/sys/kernel/debug/tracing/trace</code>文件，用于读取内核中的跟踪数据。</li><li>打开<code>/sys/kernel/debug/tracing/set_event</code>文件，用于设置要跟踪的事件类别。</li><li>打开<code>/sys/kernel/debug/tracing/trace_clock</code>文件，用于设置内核跟踪时钟。</li></ul><ol start="5"><li><p>跟踪数据输出 atrace将收集到的跟踪数据以ATRACE_TAG格式输出。这些数据可以通过Systrace工具进行可视化分析。atrace的输出数据格式与Systrace工具兼容，可以直接导入Systrace进行分析。</p></li><li><p>辅助函数 在util.cpp文件中，atrace定义了一些辅助函数，如<code>write_str</code>（用于向文件写入字符串）、<code>read_file</code>（用于读取文件内容）等。这些辅助函数简化了atrace的主要功能实现。</p></li></ol><p>通过深入分析atrace的源码，我们可以更好地了解其工作原理和实现细节。这对于使用atrace进行性能分析、定制atrace工具以满足特定需求，以及学习内核跟踪技术都非常有帮助。</p><h2 id="android操作系统使用atrace-tag-graphics预埋那些tracepoints-请详细列举出来-并说明其作用" tabindex="-1"><a class="header-anchor" href="#android操作系统使用atrace-tag-graphics预埋那些tracepoints-请详细列举出来-并说明其作用"><span>&gt; android操作系统使用ATRACE_TAG_GRAPHICS预埋那些tracepoints，请详细列举出来，并说明其作用</span></a></h2><p>ATRACE_TAG_GRAPHICS是一个跟踪标签，用于表示与Android图形系统相关的跟踪事件。Android图形系统主要涉及到SurfaceFlinger、Hardware Composer（HWC）、渲染引擎（如OpenGL ES、Vulkan）等组件。跟踪这些组件的性能可以帮助开发者发现图形渲染过程中的性能瓶颈，优化应用程序。</p><p>以下是一些与ATRACE_TAG_GRAPHICS相关的主要tracepoints，它们涵盖了Android图形系统的关键环节：</p><ol><li><p>SurfaceFlinger：</p><ul><li>SF_prepare: SurfaceFlinger准备提交一帧的开始。</li><li>SF_queueBuffer: SurfaceFlinger向屏幕提交一帧的缓冲区。</li><li>SF_latchBuffer: SurfaceFlinger从客户端获取一帧的缓冲区。</li></ul></li><li><p>Hardware Composer (HWC)：</p><ul><li>HWC_prepare: HWC准备一帧的开始。</li><li>HWC_set: HWC设置一帧的屏幕显示参数。</li><li>HWC_submit: HWC向显示硬件提交一帧的开始。</li></ul></li><li><p>渲染引擎（如OpenGL ES、Vulkan）：</p><ul><li>GLES_issueDrawCall: OpenGL ES发起一个绘制调用。</li><li>GLES_submit: OpenGL ES提交一个命令缓冲区。</li><li>VK_queueSubmit: Vulkan提交一个命令缓冲区。</li></ul></li><li><p>其他图形相关tracepoints：</p><ul><li>EGL_swapBuffers: EGL交换前后缓冲区。</li><li>HWUI_draw: Android的硬件UI渲染器（如Skia）进行绘制操作。</li></ul></li></ol><p>这些tracepoints涵盖了Android图形系统的关键环节，包括SurfaceFlinger、Hardware Composer、渲染引擎等组件。通过分析这些tracepoints的性能数据，开发者可以发现图形渲染过程中的性能瓶颈，从而优化应用程序。</p><p>需要注意的是，这些tracepoints可能会随着Android版本的迭代而发生变化，因此在使用atrace进行性能分析时，应关注对应Android版本的源代码以获取准确的tracepoints信息。</p><h2 id="解析一下-atrace-begin-body-的实现原理" tabindex="-1"><a class="header-anchor" href="#解析一下-atrace-begin-body-的实现原理"><span>&gt; 解析一下 atrace_begin_body 的实现原理</span></a></h2><p><code>atrace_begin_body</code>是一个内联函数，其主要作用是标记一个跟踪事件的开始。这个函数通常用于Android Framework层或应用层代码中，以收集应用程序运行时的性能数据。在Android Native层，对应的函数是<code>ATRACE_BEGIN</code>。</p><p><code>atrace_begin_body</code>的实现原理可以从以下几个方面进行解析：</p><ol><li><p>atrace标签：跟踪事件的开始和结束都使用相应的atrace标签进行标记。<code>atrace_begin_body</code>函数需要一个字符串参数，表示事件的名称。这个字符串将作为事件的标识，用于在跟踪数据中区分不同的事件。</p></li><li><p>写入trace_marker：<code>atrace_begin_body</code>通过向<code>/sys/kernel/debug/tracing/trace_marker</code>文件写入特定格式的字符串来标记事件的开始。这个文件由内核提供，用于接收用户空间发起的跟踪事件。字符串的格式为<code>B|&lt;pid&gt;|&lt;event_name&gt;</code>，其中<code>B</code>表示事件开始，<code>&lt;pid&gt;</code>表示进程ID，<code>&lt;event_name&gt;</code>表示事件名称。</p></li><li><p>跟踪数据收集：内核会根据写入<code>trace_marker</code>的字符串信息，在相应的tracepoint处插入探针，收集跟踪数据。这些数据将存储在内核的trace buffer中，可以通过atrace工具进行导出和分析。</p></li></ol><p>以下是<code>atrace_begin_body</code>的简化实现：</p><p>cpp</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inline</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> atrace_begin_body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 获取进程ID</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pid </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getpid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 构造写入trace_marker的字符串</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    char</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> buf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    size_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> len </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> snprintf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(buf, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(buf), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;B|</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">|</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, pid, name);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 向trace_marker写入字符串，标记事件开始</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fd </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/sys/kernel/debug/tracing/trace_marker&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, O_WRONLY);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (fd </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fd, buf, len);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fd);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过理解<code>atrace_begin_body</code>的实现原理，我们可以更好地利用这个函数来收集应用程序运行时的性能数据，从而发现性能瓶颈，优化应用程序。同时，这也有助于我们学习和了解Android内核跟踪机制的工作原理。</p><ul><li>system/core/libcutils/trace-dev.cpp</li><li>system/core/libcutils/trace-host.cpp</li></ul><h2 id="atrace-source-code" tabindex="-1"><a class="header-anchor" href="#atrace-source-code"><span>atrace source code</span></a></h2><p><a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/native/cmds/atrace/atrace.cpp" target="_blank" rel="noopener noreferrer">https://cs.android.com/android/platform/superproject/+/master:frameworks/native/cmds/atrace/atrace.cpp</a></p><p>这是Android系统中atrace工具的源代码，用于收集系统跟踪数据，包括CPU使用情况、内存分配、磁盘I/O、网络数据等等。代码中定义了atrace命令支持的各种选项，如-b用于设置缓冲区大小，-z用于压缩数据，-t用于指定跟踪时长等等。同时，代码中还实现了各种不同的跟踪类别（如gfx、view、input等），以及对于每个跟踪类别所对应的系统数据源进行设置和启用。最后，代码中还实现了对于atrace工具的使用说明和帮助信息。</p><p><a href="https://cs.android.com/android/platform/superproject/+/master:system/core/libcutils/include/cutils/trace.h" target="_blank" rel="noopener noreferrer">https://cs.android.com/android/platform/superproject/+/master:system/core/libcutils/include/cutils/trace.h</a></p><p><a href="https://cs.android.com/android/platform/superproject/+/master:system/core/libutils/include/utils/Trace.h" target="_blank" rel="noopener noreferrer">https://cs.android.com/android/platform/superproject/+/master:system/core/libutils/include/utils/Trace.h</a></p><p><a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/os/Trace.java" target="_blank" rel="noopener noreferrer">https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/os/Trace.java</a></p><p>In Android, atrace is a tool used for application profiling and debugging. It can trace a variety of events in the system, such as CPU usage, memory allocation, and graphics rendering.</p><p>The parameter &quot;gfx&quot; when using atrace refers specifically to graphics events. This allows developers to track the performance of their app&#39;s rendering pipeline, including details such as the frame rate, GPU usage, and how long it takes to render each frame. This information can help identify performance bottlenecks and improve the overall performance and user experience of the application.</p><p>atrace gfx是一个Android系统级别的跟踪类别，它允许开发人员跟踪与图形相关的事件。通过使用atrace gfx，可以监视应用程序的绘图性能，包括GPU渲染、图形合成等。它可以帮助开发人员定位应用程序的绘图性能瓶颈，并对应用程序的图形性能进行优化。</p><p>atrace gfx功能的实现代码是在Android的源代码中的frameworks/native/cmds/atrace/atrace.cpp文件中的handle_gfx函数中。具体来说，该函数使用sys_write()函数将&quot;gfx&quot;字符串写入到/sys/kernel/debug/tracing/tracing_mark_write文件中，以便将GFX跟踪标记写入跟踪缓冲区中。写入后，跟踪缓冲区中包含有关GFX操作的详细信息，可以使用其他工具（如Systrace）对其进行分析和可视化。</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/3/8 14:25:34</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: biezhihua@gmail.com">biezhihua</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">Copyright © 2025 别志华 </div></footer></div><!--]--><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CeWOgC-6.js" defer></script>
  </body>
</html>
