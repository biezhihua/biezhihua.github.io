import{_ as n,Y as a,Z as s,a2 as t}from"./framework-301d0703.js";const e={},i=t(`<h1 id="notificationlistenerservice" tabindex="-1"><a class="header-anchor" href="#notificationlistenerservice" aria-hidden="true">#</a> NotificationListenerService</h1><p><code>NotificationListenerService</code> 是 Android 中一个非常重要的服务，允许应用程序读取系统通知，也可以取消通知或触发与通知相关的动作。这个服务是在 Android 4.3（API 级别 18）引入的，主要用于创建可以访问和处理来自其他应用的通知的应用程序，如通知管理器或特定的辅助应用。</p><h3 id="主要功能" tabindex="-1"><a class="header-anchor" href="#主要功能" aria-hidden="true">#</a> 主要功能</h3><ul><li><strong>接收通知</strong>: 当系统中发布新的通知时，<code>NotificationListenerService</code> 会接收到这些通知。</li><li><strong>更新通知</strong>: 当已发布的通知被更新或修改时，服务也会收到通知。</li><li><strong>删除通知</strong>: 如果通知被取消，服务会接收到通知。</li><li><strong>特殊访问权限</strong>: 使用这个服务的应用需要用户明确授予权限，因为它关系到用户的隐私。</li></ul><h3 id="实现步骤" tabindex="-1"><a class="header-anchor" href="#实现步骤" aria-hidden="true">#</a> 实现步骤</h3><ol><li><strong>继承 <code>NotificationListenerService</code></strong>: 创建一个服务类继承自 <code>NotificationListenerService</code>。</li><li><strong>实现回调方法</strong>: <ul><li><code>onNotificationPosted()</code>: 当新通知被发布时调用。</li><li><code>onNotificationRemoved()</code>: 当通知被移除时调用。</li></ul></li><li><strong>在 AndroidManifest.xml 中声明服务</strong>: <ul><li>添加 <code>&lt;service&gt;</code> 标签，并使用 <code>android.permission.BIND_NOTIFICATION_LISTENER_SERVICE</code> 权限。</li></ul></li><li><strong>请求用户授权</strong>: 应用必须引导用户到设置中授权通知访问权限。</li></ol><h3 id="例子" tabindex="-1"><a class="header-anchor" href="#例子" aria-hidden="true">#</a> 例子</h3><h4 id="基本的-notificationlistenerservice-实现" tabindex="-1"><a class="header-anchor" href="#基本的-notificationlistenerservice-实现" aria-hidden="true">#</a> 基本的 <code>NotificationListenerService</code> 实现：</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNotificationListener</span> <span class="token keyword">extends</span> <span class="token class-name">NotificationListenerService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNotificationPosted</span><span class="token punctuation">(</span><span class="token class-name">StatusBarNotification</span> sbn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理每个收到的通知</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;MyNotificationListener&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Notification Posted: &quot;</span> <span class="token operator">+</span> sbn<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNotificationRemoved</span><span class="token punctuation">(</span><span class="token class-name">StatusBarNotification</span> sbn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理每个被移除的通知</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;MyNotificationListener&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Notification Removed: &quot;</span> <span class="token operator">+</span> sbn<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在-androidmanifest-xml-中声明服务" tabindex="-1"><a class="header-anchor" href="#在-androidmanifest-xml-中声明服务" aria-hidden="true">#</a> 在 <code>AndroidManifest.xml</code> 中声明服务：</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MyNotificationListener<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>My Notification Listener<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.BIND_NOTIFICATION_LISTENER_SERVICE<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.service.notification.NotificationListenerService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="用户授权" tabindex="-1"><a class="header-anchor" href="#用户授权" aria-hidden="true">#</a> 用户授权：</h4><p>通常需要引导用户到设置界面授权，可以通过以下代码实现：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;android.settings.ACTION_NOTIFICATION_LISTENER_SETTINGS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个功能非常强大，但也需要谨慎处理用户数据，避免侵犯隐私。在设计应用时，确保遵守适当的法律和准则。</p>`,15),o=[i];function c(p,l){return a(),s("div",null,o)}const r=n(e,[["render",c],["__file","android-notification-listener-service.html.vue"]]);export{r as default};
