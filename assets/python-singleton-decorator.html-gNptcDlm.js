import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{e as a,f as n,o as l}from"./app-v__Abch_.js";const e={};function t(p,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="进一步介绍第二种方式-wrapper是如何感知到-类被实例化的" tabindex="-1"><a class="header-anchor" href="#进一步介绍第二种方式-wrapper是如何感知到-类被实例化的"><span>进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？</span></a></h1><h2 id="思考过程" tabindex="-1"><a class="header-anchor" href="#思考过程"><span>思考过程</span></a></h2><p>在第二种方法中，包装函数如何感知类的实例化状态？</p><p>复习单例模式的装饰器实现。</p><p>今我在解释，使用&#39;@singleton&#39;注解定义的&#39;SingletonClass&#39;，实际上会调用&#39;wrapper&#39;函数来实例化。这让我想到，&#39;wrapper&#39;函数监测类的实例化过程。</p><p>深入探讨装饰器应用</p><p>我正在讲解装饰器如何实现单例模式，特别是如何使用wrapper函数感知和控制类的实例化过程。通过维护一个字典来记录实例，确保只创建一个实例。</p><h2 id="方法二-使用装饰器实现单例模式" tabindex="-1"><a class="header-anchor" href="#方法二-使用装饰器实现单例模式"><span>方法二：使用装饰器实现单例模式</span></a></h2><p>好的，我来进一步详细介绍第二种使用装饰器的方式，解释<code>wrapper</code>函数是如何感知到类被实例化的。</p><h3 id="代码回顾" tabindex="-1"><a class="header-anchor" href="#代码回顾"><span>代码回顾</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> singleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    instances </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> wrapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">kwargs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cls</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> instances:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            instances[</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*args, **kwargs)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> instances[</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> wrapper</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@singleton</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SingletonClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    pass</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="原理详解" tabindex="-1"><a class="header-anchor" href="#原理详解"><span>原理详解</span></a></h3><h4 id="_1-装饰器的基本概念" tabindex="-1"><a class="header-anchor" href="#_1-装饰器的基本概念"><span>1. 装饰器的基本概念</span></a></h4><ul><li><strong>装饰器</strong>：在Python中，装饰器是一个高阶函数，接受一个函数或类作为参数，并返回一个新的函数或类。它可以在不修改原始函数或类的情况下，扩展其功能。</li></ul><h4 id="_2-装饰器的执行过程" tabindex="-1"><a class="header-anchor" href="#_2-装饰器的执行过程"><span>2. 装饰器的执行过程</span></a></h4><ul><li><p>当我们使用<code>@singleton</code>装饰<code>SingletonClass</code>时，实际上发生了以下步骤：</p><ol><li><p><strong>定义类</strong>：首先，<code>SingletonClass</code>类被定义。</p></li><li><p><strong>应用装饰器</strong>：然后，<code>singleton</code>装饰器被调用，<code>cls</code>参数接收到<code>SingletonClass</code>类。</p></li><li><p><strong>返回包装器</strong>：装饰器返回内部定义的<code>wrapper</code>函数。</p></li><li><p><strong>替换原类</strong>：<code>SingletonClass</code>被替换为<code>wrapper</code>函数，这意味着以后对<code>SingletonClass</code>的调用实际上是对<code>wrapper</code>函数的调用。</p></li></ol></li></ul><h4 id="_3-wrapper函数如何感知实例化" tabindex="-1"><a class="header-anchor" href="#_3-wrapper函数如何感知实例化"><span>3. <code>wrapper</code>函数如何感知实例化</span></a></h4><ul><li><p><strong>替代实例化过程</strong>：由于<code>SingletonClass</code>已经被替换为<code>wrapper</code>函数，当我们试图创建<code>SingletonClass</code>的实例时，实际上是在调用<code>wrapper</code>函数。</p></li><li><p><strong>参数捕获</strong>：<code>wrapper</code>函数接受任意数量的位置参数和关键字参数（<code>*args, **kwargs</code>），这些参数原本是传递给类构造函数的。</p></li><li><p><strong>实例管理</strong>：<code>wrapper</code>函数内部维护了一个名为<code>instances</code>的字典，用于存储类的实例。</p><ul><li><p><strong>首次实例化</strong>：如果<code>cls</code>（即<code>SingletonClass</code>）不在<code>instances</code>中，表示还没有创建过实例，于是调用<code>cls(*args, **kwargs)</code>创建一个新的实例，并将其存储在<code>instances</code>中。</p></li><li><p><strong>后续实例化</strong>：如果<code>cls</code>已经在<code>instances</code>中，直接返回已存在的实例。</p></li></ul></li></ul><h4 id="_4-详细执行流程" tabindex="-1"><a class="header-anchor" href="#_4-详细执行流程"><span>4. 详细执行流程</span></a></h4><ul><li><p><strong>代码执行顺序</strong>：</p><ol><li><p><strong>定义阶段</strong>：</p><ul><li>定义<code>SingletonClass</code>。</li><li>应用装饰器，<code>SingletonClass</code>被替换为<code>wrapper</code>函数。</li></ul></li><li><p><strong>实例化阶段</strong>：</p><ul><li><p>当调用<code>SingletonClass()</code>时，实际上是调用<code>wrapper()</code>。</p></li><li><p><code>wrapper</code>函数执行以下操作：</p><ul><li><p>检查<code>instances</code>字典中是否存在<code>cls</code>的实例。</p></li><li><p>如果不存在，创建新实例并存储。</p></li><li><p>如果存在，直接返回已有实例。</p></li></ul></li></ul></li></ol></li><li><p><strong>示意图</strong>：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SingletonClass --&gt; wrapper (替换)</span></span>
<span class="line"><span>SingletonClass() --&gt; wrapper()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_5-示例代码与输出" tabindex="-1"><a class="header-anchor" href="#_5-示例代码与输出"><span>5. 示例代码与输出</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> singleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    instances </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> wrapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">kwargs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Calling wrapper for </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">__name__</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cls</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> instances:</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;No instance exists for </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">__name__</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, creating one.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            instances[</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*args, **kwargs)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Instance already exists for </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">__name__</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, returning it.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> instances[</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">cls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> wrapper</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@singleton</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SingletonClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Initializing SingletonClass with value: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">value</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.value </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 测试代码</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> SingletonClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> SingletonClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;s1.value: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s1.value</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;s2.value: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s2.value</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;s1 is s2: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s1 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> s2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>输出结果</strong>：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Calling wrapper for SingletonClass</span></span>
<span class="line"><span>No instance exists for SingletonClass, creating one.</span></span>
<span class="line"><span>Initializing SingletonClass with value: 10</span></span>
<span class="line"><span>Calling wrapper for SingletonClass</span></span>
<span class="line"><span>Instance already exists for SingletonClass, returning it.</span></span>
<span class="line"><span>s1.value: 10</span></span>
<span class="line"><span>s2.value: 10</span></span>
<span class="line"><span>s1 is s2: True</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>解释</strong>：</p><ul><li><p><strong>首次实例化<code>s1</code></strong>：</p><ul><li><p><code>wrapper</code>被调用，检测到没有<code>SingletonClass</code>的实例。</p></li><li><p>创建新实例，调用<code>SingletonClass.__init__(10)</code>。</p></li></ul></li><li><p><strong>再次实例化<code>s2</code></strong>：</p><ul><li><p><code>wrapper</code>被调用，检测到已有实例。</p></li><li><p>返回已有实例，<code>__init__</code>不会再次执行。</p></li></ul></li><li><p><strong>结果验证</strong>：</p><ul><li><p><code>s1</code>和<code>s2</code>是同一个实例，<code>s1 is s2</code>为<code>True</code>。</p></li><li><p><code>s2.value</code>仍然是<code>10</code>，即首次初始化的值。</p></li></ul></li></ul></li></ul><h3 id="为什么wrapper能够感知类的实例化" tabindex="-1"><a class="header-anchor" href="#为什么wrapper能够感知类的实例化"><span>为什么<code>wrapper</code>能够感知类的实例化</span></a></h3><ul><li><p><strong>函数替代类</strong>：通过装饰器，<code>SingletonClass</code>被<code>wrapper</code>函数替代。</p></li><li><p><strong>实例化调用被拦截</strong>：任何对<code>SingletonClass</code>的实例化调用<code>SingletonClass(*args, **kwargs)</code>，都被重定向为对<code>wrapper(*args, **kwargs)</code>的调用。</p></li><li><p><strong>控制权</strong>：<code>wrapper</code>函数获得了对实例化过程的完全控制，可以决定何时创建新实例，何时返回已有实例。</p></li></ul><h3 id="关键点总结" tabindex="-1"><a class="header-anchor" href="#关键点总结"><span>关键点总结</span></a></h3><ul><li><p><strong>装饰器返回值</strong>：装饰器返回的<code>wrapper</code>函数取代了原始类，使得对类的调用实际上是对函数的调用。</p></li><li><p><strong>闭包特性</strong>：<code>wrapper</code>函数是一个闭包，持有对<code>instances</code>字典和<code>cls</code>的引用。</p></li><li><p><strong>实例存储</strong>：<code>instances</code>字典存储了类的实例，实现了对实例的全局管理。</p></li><li><p><strong>多类支持</strong>：如果使用同一个<code>singleton</code>装饰器装饰多个类，<code>instances</code>字典会分别管理它们的实例。</p></li></ul><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ul><li><p><strong>参数传递</strong>：<code>wrapper</code>需要接受<code>*args</code>和<code>**kwargs</code>，以适应不同的构造函数参数。</p></li><li><p><strong>线程安全</strong>：在多线程环境下，需要考虑对<code>instances</code>字典的访问同步，可能需要使用线程锁。</p></li><li><p><strong>不可继承性</strong>：这种方式对继承关系的处理需要谨慎，可能需要额外的逻辑。</p></li></ul><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><ul><li><p><strong><code>wrapper</code>感知实例化的机制</strong>：因为<code>wrapper</code>函数替代了原始的类，所有对类的实例化请求都由<code>wrapper</code>函数处理。</p></li><li><p><strong>实现单例的关键</strong>：通过在<code>wrapper</code>中控制实例的创建和返回，实现了单例模式。</p></li><li><p><strong>优势</strong>：这种方法简单直观，易于理解和实现，适用于不需要复杂继承关系的场景。</p></li></ul><p>希望通过以上详细解释，你能清楚地了解第二种方式中<code>wrapper</code>函数是如何感知并控制类的实例化过程的。</p>`,34)]))}const k=i(e,[["render",t],["__file","python-singleton-decorator.html.vue"]]),d=JSON.parse(`{"path":"/public-articles/python-singleton-decorator.html","title":"进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？","lang":"zh-CN","frontmatter":{"description":"进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？ 思考过程 在第二种方法中，包装函数如何感知类的实例化状态？ 复习单例模式的装饰器实现。 今我在解释，使用'@singleton'注解定义的'SingletonClass'，实际上会调用'wrapper'函数来实例化。这让我想到，'wrapper'函数监测类的实例化过程。 深入探讨装饰器应...","head":[["meta",{"property":"og:url","content":"https://github.com/biezhihua/public-articles/python-singleton-decorator.html"}],["meta",{"property":"og:site_name","content":"biezhihua的日常"}],["meta",{"property":"og:title","content":"进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？"}],["meta",{"property":"og:description","content":"进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？ 思考过程 在第二种方法中，包装函数如何感知类的实例化状态？ 复习单例模式的装饰器实现。 今我在解释，使用'@singleton'注解定义的'SingletonClass'，实际上会调用'wrapper'函数来实例化。这让我想到，'wrapper'函数监测类的实例化过程。 深入探讨装饰器应..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-08T14:25:34.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-08T14:25:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"进一步介绍第二种方式，wrapper是如何感知到 类被实例化的？\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-08T14:25:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"别志华\\",\\"url\\":\\"https://github.com/biezhihua\\"}]}"]]},"git":{"createdTime":1728993995000,"updatedTime":1741443934000,"contributors":[{"name":"biezhihua","username":"biezhihua","email":"biezhihua@gmail.com","commits":2,"url":"https://github.com/biezhihua"}]},"readingTime":{"minutes":4.8,"words":1441},"filePathRelative":"public-articles/python-singleton-decorator.md","localizedDate":"2024年10月15日","excerpt":"","autoDesc":true}`);export{k as comp,d as data};
