import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{e as a,f as n,o as l}from"./app--bm1PHxT.js";const h={};function e(k,i){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="逆向工程核心原理" tabindex="-1"><a class="header-anchor" href="#逆向工程核心原理"><span>逆向工程核心原理</span></a></h1><p>那么，读者应该如何使用本书学习逆向分析技术呢？对此，我给出如下几点建议，供各位参考。 第一，技术书不是装饰书架的道具，它们是提高各位技术水平的工具。所以阅读时要勾画出重要部分，在书页空白处写下自己的想法与心得等。阅读时，在书页上记录相关技术、注意事项、技术优缺点、与作者的不同见解等，让它成为只属于你的书。读完这样一本逆向分析技术书后，不知不觉间就构建出自己独特的逆向分析世界，最终成为代码逆向分析专家。</p><p>第二，拥有积极乐观的心态。逆向分析是一项深奥的技术，会涉及OS底层知识。要学的内容很多，并且大部分内容需要亲自测试并确认才能最终理解。必须用积极乐观的心态对待这一过程，学习逆向技术无关聪明与否，只跟投入时间的多少有关。学习时，不要太急躁，请保持轻松的心态。</p><p>第三，不断挑战。逆向分析不尽如人意时，不要停下来，要尝试其他方法，不断挑战。要相信一定会有解决的方法，可能几年前早已有人成功过了。搜索相关资料并不断尝试，不仅能提高自身技术水平，解决问题后，心里还能感受到一种成就感。这样的成功经验一点点积累起来，自信心就会大大增强，自身的逆向分析水平也会得到明显提高。这种从经验中获得的自信会不知不觉地对逆向分析过程产生积极影响，让逆向分析往更好的方向发展。</p><p>希望本书能够帮助各位把“心愿表”上的愿望一一实现，也希望各位把本书讲解的知识、技术广泛应用到逆向分析过程中，发挥更大的作用。谢谢。</p><h2 id="第一部分代码逆向技术基础" tabindex="-1"><a class="header-anchor" href="#第一部分代码逆向技术基础"><span>第一部分 代码逆向技术基础</span></a></h2><h3 id="第1章-关于逆向工程" tabindex="-1"><a class="header-anchor" href="#第1章-关于逆向工程"><span>第1章 关于逆向工程</span></a></h3><p>1.1 逆向工程</p><p>1.2 代码逆向工程</p><p>1.2.1 逆向分析法</p><p>1.2.2 源代码、十六进制代码、汇编代码</p><p>1.2.3 “打补丁”与“破解”</p><p>1.3 代码逆向准备 1.3.1 目标 1.3.2 激情 1.3.3 谷歌</p><p>1.4 学习逆向分析技术的禁忌 1.4.1 贪心 1.4.2 急躁 1.5 逆向分析技术的乐趣</p><h3 id="第2章逆向分析hello-world-程序" tabindex="-1"><a class="header-anchor" href="#第2章逆向分析hello-world-程序"><span>第2章 逆向分析Hello World!程序</span></a></h3><p>2.1 Hello World!程序</p><p>2.2 调试HelloWorld. exe程序 2.2.1 调试目标 2.2.2 开始调试 2.2.3 入口点 2.2.4 跟踪40270C函数 2.2.5 跟踪40104F跳转语句 2.2.6 查找main()函数</p><p>2.3 进一步熟悉调试器 2.3.1 调试器指令 2.3.2 “大本营” 2.3.3 设置“大本营”的四种方法</p><p>2.4 快速查找指定代码的四种方法 2.4.1 代码执行法 2.4.2 字符串检索法 2.4.3 API检索法 (1): 在调用代码中设置断点 2.4.4 API检索法 (2): 在API代码中设置断点</p><p>2.5 使用“打补丁”方式修改“HelloWorld!”字符串 2.5.1 “打补丁” 2.5.2 修改字符串的两种方法</p><p>2.6 小结</p><h3 id="第3章-小端序标记法" tabindex="-1"><a class="header-anchor" href="#第3章-小端序标记法"><span>第3章 小端序标记法</span></a></h3><p>3.1 字节序 3.1.1 大端序与小端序 3.1.2 在OllyDbg中查看小端序</p><h3 id="第4章-ia-32寄存器基本讲解" tabindex="-1"><a class="header-anchor" href="#第4章-ia-32寄存器基本讲解"><span>第4章 IA-32寄存器基本讲解</span></a></h3><p>4.1 什么是CPU寄存器 4.2 IA-32寄存器</p><ul><li>通用寄存器(General Purpose Registers,32位) <ul><li>各寄存器的名称如下所示。 <ul><li>EAX：（针对操作数和结果数据的）累加器</li><li>EBX:（DS段中的数据指针）基址寄存器</li><li>ECX：（字符串和循环操作的）计数器</li><li>EDX:（I/O指针）数据寄存器</li><li>此外，ECX与EAX也可以用于特殊用途。循环命令(LOOP)中，ECX用来循环计数(loop count)，每执行一次循环，ECX都会减1.EAX一般用在函数返回值中，所有Win32API函数都会先把返回值保存到EAX再返回。</li><li>EBP:（SS段中栈内数据指针）扩展基址指针寄存器</li><li>ESI：（字符串操作源指针）源变址寄存器</li><li>EDI：（字符串操作目标指针）目的变址寄存器</li><li>ESP:（SS段中栈指针）栈指针寄存器</li><li>以上4个寄存器主要用作保存内存地址的指针。</li><li>ESP指示栈区域的栈顶地址，某些指令(PUSH、POP、CALL、RET)可以直接用来操作ESP（栈区域管理是程序中相当重要的部分，请不要把ESP用作其他用途）。</li><li>EBP表示栈区域的基地址，函数被调用时保存ESP的值，函数返回时再把值返回ESP，保证栈不会崩溃（这称为栈帧(StackFrame)技术，它是代码逆向分析技术中的一个重要概念，后面会详细讲解）。</li><li>ESI和EDI与特定指令(LODS、STOS、REP、MOVS等)一起使用，主要用于内存复制。</li></ul></li></ul></li><li>段寄存器(Segment Registers,16位，6个) <ul><li>CS: Code Segment, 代码段寄存器</li><li>SS: Stack Segment, 栈段寄存器</li><li>DS: Data Segment,数据段寄存器</li><li>ES: Extra(Data) Segment, 附加（数据）段寄存器</li><li>FS: Data Segment, 数据段寄存器</li><li>GS: Data Segment, 数据段寄存器</li></ul></li><li>程序状态与控制寄存器(Program Status and Control Registers,32位，1个) <ul><li>EFLAGS: Flag Register, 标志寄存器</li><li>学习代码逆向分析技术的初级阶段，只要掌握3个与程序调试相关的标志即可，分别为ZF(ZeroFlag，零标志)、OF (Overflow Flag, 溢出标志)、CF(Carry Flag, 进位标志)。</li><li>ZF 若运算结果为0, 则其值为1(True), 否则其值为0(False).</li><li>OF 有符号整数(signed integer) 溢出时, OF值被置为1。此外, MSB(Most Significant Bit,最高有效位)改变时，其值也被设为1.</li><li>CF 无符号整数(unsigned integer)溢出时，其值也被置为1.</li></ul></li><li>指令指针寄存器(Instruction Pointer,32位，1个) <ul><li>EIP: Instruction Pointer, 指令指针寄存器</li><li>指令指针寄存器保存着CPU要执行的指令地址，其大小为32位（4个字节），由原16位IP寄存器扩展而来。程序运行时，CPU会读取EIP中一条指令的地址，传送指令到指令缓冲区后，EIP寄存器的值自动增加，增加的大小即是读取指令的字节大小。这样，CPU每次执行完一条指令，就会通过EIP寄存器读取并执行下一条指令。</li><li>与通用寄存器不同，我们不能直接修改EIP的值，只能通过其他指令间接修改，这些特定指令包括JMP、Jcc、CALL、RET.此外，我们还可以通过中断或异常来修改EIP的值。</li></ul></li></ul><p>Intel® 64 和 IA-32 架构软件开发人员手册合并卷：1、2A、2B、2C、2D、3A、3B、3C、3D 和 4</p><ul><li>Volume 1: Basic Architecture <ul><li>CHAPTER 3 BASIC EXECUTION ENVIRONMENT <ul><li>3.4 BASIC PROGRAM EXECUTION REGISTERS <ul><li>3.4.1 General-Purpose Registers</li><li>3.4.2 Segment Registers</li><li>3.4.3 EFLAGS Register <ul><li>3.4.3.1 Status Flags</li></ul></li></ul></li></ul></li></ul></li></ul><p>4.3 小结</p><h3 id="第5章-栈" tabindex="-1"><a class="header-anchor" href="#第5章-栈"><span>第5章 栈</span></a></h3><p>5.1 栈</p><p>5.1.1 栈的特征</p><p>5.1.2 栈操作示例</p><p>向栈压入数据时，栈顶指针减小，向低地址移动；从栈中弹出数据时，栈顶指针增加，向高地址移动。</p><h3 id="第6章-分析abex-crackme-1" tabindex="-1"><a class="header-anchor" href="#第6章-分析abex-crackme-1"><span>第6章 分析abex&#39; crackme#1</span></a></h3><p>6.1 abex&#39; crackme #1 6.1.1 开始调试 6.1.2 分析代码</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PUSH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	入栈指令</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	调用指定位置的函数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">INC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	值加1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">DEC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	值减1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JMP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	跳转到指定地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CMP</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">比较给定的两个操作数</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">与SUB命令类似，但操作数的值不会改变，仅改变EFLAGS寄存器（若2个操作数的值一致,SUB结果为0,ZF被置为1）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	条件跳转指令</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Jump </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">if</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> equal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) *若ZF为1, 则跳转</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>6.2 破解</p><p>6.3 将参数压入栈</p><p>6.4 小结</p><h3 id="第7章栈帧" tabindex="-1"><a class="header-anchor" href="#第7章栈帧"><span>第7章 栈帧</span></a></h3><p>7.1 栈帧</p><p>栈帧(StackFrame)相关知识，栈帧在程序中用于声明局部变量、调用函数。</p><p>简言之，栈帧就是利用EBP（栈帧指针，请注意不是ESP）寄存器访问栈内局部变量、参数、函数返回地址等的手段。</p><p>为什么使用EBP而不是ESP？ 程序运行中，ESP寄存器的值随时变化，访问栈中函数的局部变量、参数时，若以ESP值为基准编写程序会十分困难，并且也很难使CPU引用到准确的地址。 所以，调用某函数时，先要把用作基准点（函数起始地址）的ESP值保存到EBP,并维持在函数内部。 这样，无论ESP的值如何变化，以EBP的值为基准(base)能够安全访问到相关函数的局部变量、参数、返回地址，这就是EBP寄存器作为栈帧指针的作用。</p><p>栈帧结构</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PUSH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EBP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	      ；函数开始（使用EBP前先把已有值保存到栈中）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MOV</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EBP,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ESP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	  ；保存当前ESP到EBP中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                ；函数体</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                ；无论ESP值如何变化，EBP都保持不变，可以安全访问函数的局部变量、参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MOV</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ESP,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EBP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	  ；将函数的起始地址返回到ESP中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">POP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EBP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	        ；函数返回前弹出保存在栈中的EBP值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RETN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	          ；函数终止</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>借助栈帧技术管理函数调用时，无论函数调用的深度有多深、多复杂，调用栈都能得到很好的管理与维护。</p><p>提示</p><ul><li>最新的编译器中都带有一个“优化”(Optimization)选项，使用该选项编译简单的函数将不会生成栈帧。</li><li>在栈中保存函数返回地址是系统安全隐患之一，攻击者使用缓冲区溢出技术能够把保存在栈内存的返回地址更改为其他地址。</li></ul><p>7.2 调试示例：stackframe. exe</p><p>7.2.1 StackFrame.cpp</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;stdio.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">long</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a, y </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> b;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (x</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">y);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argv</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">[]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, b </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> c </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(a, b);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Sum of </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%ld</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%ld</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%ld</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, a, b, c);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.2 开始执行main()函数&amp;生成栈帧</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18D0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">stackfram</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StackFrame.c:12</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18D1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18D3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">81EC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> E4000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sub</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,E4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">生成栈空间</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18D9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">53</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18DA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">56</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   | </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18DB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">57</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">stackfram</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8D7D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lea</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edi,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-24]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">初始化局部变量空间</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18DF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">B9</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 09000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  | </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18E4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">B8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                           | </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18E9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">F3:AB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stosd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.3 设置局部变量</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18F6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C745</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 01000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8],1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">把数据1保存到[EBP-8]中，[EBP-8]代表局部变量a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18FD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C745</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 02000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14],2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">把数据1保存到[EBP-14]中，[EBP-14]代表局部变量b</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>提示 DWORD PTR SS:[EBP-4]语句中, SS是Stack Segment的缩写，表示栈段。由于Windows中使用的是段内存模型(Segment Memory Model), 使用时需要指出相关内存属于哪一个区段。其实，32位的Windows OS中, SS、DS、ES的值皆为0, 所以采用这种方式附上区段并没有什么意义。因EBP与ESP是指向栈的寄存器，所以添加上了SS寄存器。请注意,“DWORD PTR”与“SS:”等字符串可以通过设置OllyDbg的相应选项来隐藏。</p><p>7.2.4 add()函数参数传递与调用</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1904</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1907</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">arg2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1908</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B4D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D190B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">51</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">arg1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D190C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12F7FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.4D1023</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call的同时会push下一个指令的地址004D1911，也叫做返回地址</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回地址 执行CALL命令进入被调用的函数之前，CPU会先把函数的返回地址压入栈，用作函数执行完毕后的返回地址。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0041FA90</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      004D1911</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EncStackInitEnd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__enc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$textbss$end</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0041FA94</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      00000001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0041FA98</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      00000002</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.5 开始执行add()函数&amp;生成栈帧</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StackFrame.c:6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">81EC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> D8000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sub</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,D8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                 |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，main（）函数使用的EBP值被备份到栈中，然后EBP的值被设置为一个新值。</p><p>7.2.6 设置add()函数的局部变量(x,y)</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp+8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">取出参数a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8945</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8],eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">设置局部变量值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp+C]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">取出参数b</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8945</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14],eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">设置局部变量值</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCC8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCCC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000002</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCD0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCD4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCD8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCDC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          0040FDE0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     EBP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          004D1911</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EncStackInitEnd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__enc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$textbss$end</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCEC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000002</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.7 ADD运算</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18A2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">使用局部变量计算</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18A5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0345</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.8 删除函数add()的栈帧&amp;函数执行完毕（返回）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18B8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BE5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18BA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D18BB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ret</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                        |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这条命令用于恢复函数add（）开始执行时备份到栈中的EBP值，它与401000地址处的PUSH EBP命令对应。EBP值恢复为12FF40, 它是main（）函数的EBP值。到此, add（）函数的栈帧就被删除了。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          004D1911</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EncStackInitEnd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.__enc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$textbss$end</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCEC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000002</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.9 从栈中删除函数add()的参数（整理栈）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1904</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StackFrame.c:14</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1907</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1908</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B4D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_2339CD9D_StackFrame@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D190B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">51</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_2339CD9D_StackFrame@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D190C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12F7FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.4D1023</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1911</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">83C4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCE8</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCEC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          00000002</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCF0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EntryP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 004D1028</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ESP</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040FCF4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EntryP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 004D1028</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     stackframe.__enc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$textbss$end</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+28</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提示</p><ul><li>被调函数执行完毕后，函数的调用者(Caller)负责清理存储在栈中的参数，这种方式称为cdecl方式；</li><li>反之，被调用者(Callee)负责清理保存在栈中的参数，这种方式称为stdcall方式。这些函数调用规则统称为调用约定(Calling Convention), 这在程序开发与分析中是一个非常重要的概念，第10章将进一步讲解相关内容。</li></ul><p>7.2.10 调用printf()函数</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1914</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8945</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> E0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-20],eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1917</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> E0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-20]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StackFrame.c:15</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D191A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D191B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B4D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-14]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D191E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">51</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D191F</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1922</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1923</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">68</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 307B4D00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.4D7B30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">4D7B30:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;Sum of %ld and %ld is %ld\\n&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1928</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AAF7FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stackframe.4D10D7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D192D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">83C4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.2.11 设置返回值</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1930</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">33C0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StackFrame.c:16</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>XOR命令用来进行Exclusive OR bit（异或）运算，其特点为“2个相同的值进行XOR运算，结果为0”.XOR命令比MOV EAX，0命令执行速度快，常用于寄存器的初始化操作。</p><p>7.2.12 删除栈帧&amp; main()函数终止</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1942</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BE5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1944</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004D1945</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ret</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                        |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.3 设置OllyDbg选项 7.3.1 Disasm选项 7.3.2 Analysis1选项</p><p>7.4 小结</p><h3 id="第8章-abex-crackme-2" tabindex="-1"><a class="header-anchor" href="#第8章-abex-crackme-2"><span>第8章 abex&#39; crackme#2</span></a></h3><p>8.1 运行abex&#39; crackme#2</p><p>8.2 Visual Basic文件的特征 8.2.1 VB专用引擎 8.2.2 本地代码和伪代码 8.2.3 事件处理程序 8.2.4 未文档化的结构体</p><p>8.3 开始调试</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00401238</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">68</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 141E4000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> abex&#39; crackme #2.401E14                               |</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0040123D  | E8 F0FFFFFF        | call &lt;JMP.&amp;ThunRTMain&gt;                                     |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>8.3.1 间接调用</p><p>8.3.2 RT MainStruct结构体</p><p>8.3.3 ThunRTMain()函数</p><p>8.4 分析crackme</p><p>8.4.1 检索字符串</p><p>TEST: 逻辑比较(Logical Compare) 与bit-wise logical\`AND&#39;一样（仅改变EFLAGS寄存器而不改变操作数的值）若2个操作数中一个为0，则AND运算结果被置为0 -&gt; ZF = 1 。 JE: 条件转移指令(Jump if equal) 若ZF=1, 则跳转。</p><p>8.4.2 查找字符串地址</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403321</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8D55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lea</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-44]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403324</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8D45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lea</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-34]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                              |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403327</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403328</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403329</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FF15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 58104000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">__vbaVarTstEq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                       |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040332F</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">66:85C0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ax,ax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403332</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0F84</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> D0000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">je</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> abex&#39; crackme #2.403408                                 |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>8.4.3 生成Serial的算法</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402ED0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402ED1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>NOP: No Operation, 不执行任何动作的指令（只消耗CPU时钟）。</p><p>8.4.4 预测代码</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402F8E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8D95</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 78FFFFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lea</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-88]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                              | [ebp-88]</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">:L</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;BIEZHIHUA&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402F94</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402F95</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">56</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402F96</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B0E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[esi]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00402F98</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FF91</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> A0000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[ecx+A0]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>8.4.5 读取Name字符串的代码</p><p>8.4.6 加密循环</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403102</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BB</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 04000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebx,4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0040318B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FF15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30104000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">__vbaVarForInit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403191</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B1D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4C104000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtcMidCharVar</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403197</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">85C0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                               |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00403199</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0F84</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 06010000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">je</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> abex&#39; crackme #2.4032A5                                 |</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0040329A  | FF15 C0104000      | call dword ptr ds:[&lt;&amp;__vbaVarForNext&gt;]                     |</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">004032A0  | E9 F2FEFFFF        | jmp abex&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crackme</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #2.403197                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">004032A5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp+8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>8.4.7 加密方法</p><p>8.5 小结</p><h2 id="第9章-process-explorer———最优秀的进程管理工具" tabindex="-1"><a class="header-anchor" href="#第9章-process-explorer———最优秀的进程管理工具"><span>第9章 Process Explorer———最优秀的进程管理工具</span></a></h2><p>9.1 Process Explorer 9.2 具体有哪些优点呢 9.3 sysinternals</p><h3 id="第10章函数调用约定" tabindex="-1"><a class="header-anchor" href="#第10章函数调用约定"><span>第10章 函数调用约定</span></a></h3><p>10.1 函数调用约定</p><p>函数调用约定(Calling Convention) |</p><p>主要的函数调用约定如下。</p><ul><li>cdecl</li><li>stdcall</li><li>fastcall</li></ul><p>术语说明</p><ul><li>调用者————调用函数的一方。</li><li>被调用者————被调用的函数。</li><li>比如在main()函数中调用printf()函数时，调用者为main(),被调用者为printf().</li></ul><p>10.1.1 cdecl</p><p>cdecl是主要在C语言中使用的方式，调用者负责处理栈。</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> b;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> argv</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">[]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF17F2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6A</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 02</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                     | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.c:12</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF17F4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6A</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 01</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF17F6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 28F8FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.EF1023</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF17FB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">83C4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exe_common.inl:77</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F13</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">83EC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sub</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 83F3FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.EF129E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exe_common.inl:78</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F1B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8945</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-4],eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | [ebp-4]</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ALLUSERSPROFILE=C:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ProgramData&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F1E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 85F3FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.EF12A8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F23</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[eax]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8945</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8],eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | [ebp-8]</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;E:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Projects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VisualStudioProjects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Debug</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.exe&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F28</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3CF1FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.EF1069</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F2D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ds:[eax]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F2F</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">894D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-C],ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-4]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | [ebp-4]</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ALLUSERSPROFILE=C:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ProgramData&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F35</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">52</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F36</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | [ebp-8]</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;E:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Projects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VisualStudioProjects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Debug</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.exe&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F39</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F3A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B4D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> F4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp-C]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F3D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">51</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F3E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 92F3FFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.EF12D5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F43</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">83C4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F46</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BE5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exe_common.inl:79</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F48</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00EF1F49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ret</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                        |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>10.1.2 stdcall</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41780</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.c:6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41781</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41783</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">81EC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> C0000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sub</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,C0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41789</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">53</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F4178A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">56</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">esi:__enc$textbss$end+23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F4178B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">57</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                   |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F4178C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BFD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edi,ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F4178E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">33C9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,ecx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41790</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">B8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,CCCCCCCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                           | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">eax:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41795</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">F3:AB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stosd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                  |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F41797</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">B9</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 00C0F400</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cdecl._E28DA64E_cdecl@</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">c&gt;                          | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.c:15732480,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ecx:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F4179C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7FFBFFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.F41320</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417A1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">90</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                        |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417A2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8B45</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 08</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp+8]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.c:7,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax:_E28DA64E_cdecl@c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417A5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0345</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0C</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eax,dword</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ptr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss:[ebp+C]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">eax:_E28DA64E_cdecl@c,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ebp+C]:&amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;E:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Projects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VisualStudioProjects</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Debug</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.exe&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417A8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5F</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> edi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cdecl.c:8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417A9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5E</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">esi:__enc$textbss$end+23</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417AA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417AB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">81C4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> C0000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,C0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417B1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3BEC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cmp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp,esp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417B3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">E8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8CFAFFFF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cdecl.F41244</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417B8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8BE5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mov</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> esp,ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417BA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                    |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00F417BB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0800</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ret</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                      |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>10.1.3 fastcall</p><h3 id="第11章视频讲座" tabindex="-1"><a class="header-anchor" href="#第11章视频讲座"><span>第11章 视频讲座</span></a></h3><p>11.1 运行 11.2 分析 11.2.1 目标 (1): 去除消息框 11.2.2 打补丁 (1): 去除消息框 11.2.3 目标 (2): 查找注册码 11.3 小结</p><h3 id="第12章究竟应当如何学习代码逆向分析" tabindex="-1"><a class="header-anchor" href="#第12章究竟应当如何学习代码逆向分析"><span>第12章 究竟应当如何学习代码逆向分析</span></a></h3><p>12.1 逆向工程 12.1.1 任何学习都应当有目标 12.1.2 拥有积极心态 12.1.3 要感受其中的乐趣 12.1.4 让检索成为日常生活的一部分 12.1.5 最重要的是实践 12.1.6 请保持平和的心态</p><p>代码逆向分析技术的初学者最容易犯的毛病是急躁。总想快速出成果，结果学习却不见起色，技术水平原地踏步。 自己究竟还有多少不懂、能不能顺利进行下去，这都让人一头雾水、心烦不已。 汇编、Windows内部结构、PE文件格式、API钩取等都不是易学的内容，仅汇编一项就学无止境。 此时心浮气躁就很容易放弃目标。</p><h2 id="第二部分-pe文件格式" tabindex="-1"><a class="header-anchor" href="#第二部分-pe文件格式"><span>第二部分 PE文件格式</span></a></h2><h3 id="第13章-pe文件格式-90" tabindex="-1"><a class="header-anchor" href="#第13章-pe文件格式-90"><span>第13章 PE文件格式 90</span></a></h3><p>13.1 介绍⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯90</p><p>PE文件是Windows操作系统下使用的可执行文件格式。 它是微软在UNIX平台的COFF(Common Object File Format, 通用对象文件格式)基础上制作而成的。</p><p>13.2 PE文件格式⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯90</p><p>如何加载到内存、从何处开始运行、运行中需要的DLL有哪些、需要多大的栈/堆内存等，大量信息以结构体形式存储在PE头中。换言之，学习PE文件格式就是学习PE头中的结构体。</p><p>13.2.1 基本结构⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯91</p><p>https://www.openrce.org/reference_library/files/reference/PE%20Format.pdf</p><p>从DOS头(DOS header)到节区头(Section header)是PE头部分，其下的节区合称PE体。 文件中使用偏移(offset), 内存中使用VA(Virtual Address, 虚拟地址)来表示位置。 文件加载到内存时，情况就会发生变化（节区的大小、位置等）。 文件的内容一般可分为代码(.text)、数据(. data)、资源 (. rsrc) 节，分别保存。</p><p>各节区头定义了各节区在文件或内存中的大小、位置、属性等。</p><p>PE头与各节区的尾部存在一个区域，称为NULL填充(NULL padding)。</p><p>计算机中，为了提高处理文件、内存、网络包的效率，使用“最小基本单位”这一概念，PE文件中也类似。</p><p>文件/内存中节区的起始位置应该在各文件/内存最小单位的倍数位置上，空白区域将用NULL填充（看图13-2，可以看到各节区起始地址的截断都遵循一定规则）。</p><p>13.2.2 VA&amp;RVA⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯92</p><p>基准位置(ImageBase)。</p><p>VA指的是进程虚拟内存的绝对地址, RVA(Relative Virtual Address, 相对虚拟地址)指从某个基准位置(ImageBase)开始的相对地址。</p><p>VA与RVA满足下面的换算关系：</p><ul><li>RVA+ImageBase=VA</li></ul><p>PE头内部信息大多以RVA形式存在。原因在于，PE文件（主要是DLL）加载到进程虚拟内存的特定位置时，该位置可能已经加载了其他PE文件(DLL)。 此时必须通过重定位(Relocation)将其加载到其他空白的位置，若PE头信息使用的是VA，则无法正常访问。因此使用RVA来定位信息，即使发生了重定位，只要相对于基准位置的相对地址没有变化，就能正常访问到指定信息，不会出现任何问题。</p><p>提示</p><ul><li>32位WindowsOS中，各进程分配有4GB的虚拟内存，因此进程中VA值的范围是00000000~FFFFFFFF.</li></ul><p>13.3 PE头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯92</p><p>13.3.1 DOS头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯93</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// D:\\Windows Kits\\10\\Include\\10.0.26100.0\\um\\winnt.h</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_DOS_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      // DOS .EXE header</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_magic;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                     // Magic number</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_cblp;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      // Bytes on last page of file</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_cp;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // Pages in file</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_crlc;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      // Relocations</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_cparhdr;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   // Size of header in paragraphs</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_minalloc;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  // Minimum extra paragraphs needed</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_maxalloc;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  // Maximum extra paragraphs needed</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_ss;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // Initial (relative) SS value</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_sp;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // Initial SP value</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_csum;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      // Checksum</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_ip;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // Initial IP value</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_cs;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // Initial (relative) CS value</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_lfarlc;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // File address of relocation table</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_ovno;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      // Overlay number</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">e_res</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // Reserved words</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_oemid;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                     // OEM identifier (for e_oeminfo)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   e_oeminfo;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   // OEM information; e_oemid specific</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">e_res2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  // Reserved words</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    LONG   e_lfanew;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // File address of new exe header</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_DOS_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_DOS_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IMAGE_DOS_HEADER结构体的大小为64个字节。</p><p>在该结构体中必须知道2个重要成员：e_magic与e_lfanew.</p><ul><li>e_magic: DOS签名(signature,4D5A=&gt;ASCII值“MZ”).</li><li>e_lfanew：指示NT头的偏移（根据不同文件拥有可变值）。</li></ul><p>13.3.2 DOS存根⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯94</p><p>13.3.3 NT头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯94</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SIZEOF_FILE_HEADER</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_NT_HEADERS64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD Signature;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_FILE_HEADER FileHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_OPTIONAL_HEADER64 OptionalHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_NT_HEADERS64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_NT_HEADERS64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_NT_HEADERS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD Signature;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_FILE_HEADER FileHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_NT_HEADERS32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_NT_HEADERS32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_ROM_HEADERS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_FILE_HEADER FileHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_ROM_OPTIONAL_HEADER OptionalHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_ROM_HEADERS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_ROM_HEADERS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> _WIN64</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> IMAGE_NT_HEADERS64                  IMAGE_NT_HEADERS;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PIMAGE_NT_HEADERS64                 PIMAGE_NT_HEADERS;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#else</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> IMAGE_NT_HEADERS32                  IMAGE_NT_HEADERS;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PIMAGE_NT_HEADERS32                 PIMAGE_NT_HEADERS;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IMAGE_NT_HEADERS结构体由3个成员组成:</p><ul><li>第一个成员为签名(Signature)结构体，其值为50450000h(&quot;PE&quot;00)。</li><li>文件头(File Header)</li><li>可选头(Optional Header)结构体。</li></ul><p>13.3.4 NT头：文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯95</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_FILE_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    Machine;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    NumberOfSections;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   TimeDateStamp;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   PointerToSymbolTable;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   NumberOfSymbols;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    SizeOfOptionalHeader;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    Characteristics;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_FILE_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_FILE_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IMAGE_FILE_HEADER 20个字节</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>4C01      Machine</span></span>
<span class="line"><span>0500      NumberOfSections</span></span>
<span class="line"><span>1413B351  TimeDateStamp</span></span>
<span class="line"><span>00000000  PointerToSymbolTable</span></span>
<span class="line"><span>00000000  NumberOfSymbols</span></span>
<span class="line"><span>E000      SizeOfOptionalHeader</span></span>
<span class="line"><span>0201      Characteristics</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IMAGE_FILE_HEADER结构体中有如下4种重要成员（若它们设置不正确，将导致文法正常运行）。</p><p>#1. Machine 每个CPU都拥有唯一的Machine码，兼容32位Intel x86芯片的Machine码为14C.以下是定义在winnt. h文件中的Machine码。</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_UNKNOWN</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           0</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_TARGET_HOST</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0001</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Useful for indicating we want to interact with the host and not a WoW guest.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_I386</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">014c</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Intel 386.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_R3000</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0162</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS little-endian, 0x160 big-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_R4000</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0166</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_R10000</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0168</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_WCEMIPSV2</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0169</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS little-endian WCE v2</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_ALPHA</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0184</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Alpha_AXP</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_SH3</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01a2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // SH3 little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_SH3DSP</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01a3</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_SH3E</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01a4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // SH3E little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_SH4</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01a6</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // SH4 little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_SH5</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01a8</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // SH5</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_ARM</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01c0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ARM Little-Endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_THUMB</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01c2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ARM Thumb/Thumb-2 Little-Endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_ARMNT</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01c4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ARM Thumb-2 Little-Endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_AM33</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01d3</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_POWERPC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">           0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01F0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // IBM PowerPC Little-Endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_POWERPCFP</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01f1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_IA64</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0200</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Intel 64</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_MIPS16</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0266</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_ALPHA64</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">           0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0284</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ALPHA64</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_MIPSFPU</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">           0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0366</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_MIPSFPU16</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0466</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // MIPS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_AXP64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             IMAGE_FILE_MACHINE_ALPHA64</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_TRICORE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">           0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0520</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Infineon</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_CEF</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0CEF</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_EBC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0EBC</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // EFI Byte Code</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_AMD64</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8664</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // AMD64 (K8)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_M32R</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">9041</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // M32R little-endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_ARM64</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">AA64</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ARM64 Little-Endian</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_MACHINE_CEE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">C0EE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>#2. NumberOfSections 前面提到过，PE文件把代码、数据、资源等依据属性分类到各节区中存储。 NumberOfSections用来指出文件中存在的节区数量。该值一定要大于0，且当定义的节区数量与实际节区不同时，将发生运行错误。</p><p>#3. SizeOfOptionalHeader IMAGE_NT_HEADERS结构体的最后一个成员为IMAGE_OPTIONAL_HEADER32结构体。SizeOfOptionalHeader成员用来指出IMAGE_OPTIONAL_HEADER32结构体的长度。IMAGE_OPTIONAL_HEADER32结构体由C语言编写而成，故其大小已经确定。但是Windows的PE装载器需要查看IMAGE_FILE_HEADER的SizeOfOptionalHeader值，从而识别出IMAGE_OPTIONAL_HEADER32结构体的大小。 PE32+格式的文件中使用的是IMAGE_OPTIONAL_HEADER64结构体，而不是IMAGE_OPTIONAL_HEADER32结构体。2个结构体的尺寸是不同的，所以需要在SizeOfOptionalHeader成员中明确指出结构体的大小。</p><p>#4. Characteristics 该字段用于标识文件的属性，文件是否是可运行的形态、是否为DLL文件等信息，以bit OR形式组合起来。 以下是定义在winnt.h文件中的Characteristics值(请记住0002h与2000h这两个值)。</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_RELOCS_STRIPPED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">           0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0001</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Relocation info stripped from file.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_EXECUTABLE_IMAGE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">          0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0002</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // File is executable  (i.e. no unresolved external references).</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_LINE_NUMS_STRIPPED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">        0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0004</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Line nunbers stripped from file.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_LOCAL_SYMS_STRIPPED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0008</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Local symbols stripped from file.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_AGGRESIVE_WS_TRIM</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0010</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Aggressively trim working set</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_LARGE_ADDRESS_AWARE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0020</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // App can handle &gt;2gb addresses</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_BYTES_REVERSED_LO</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0080</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Bytes of machine word are reversed.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_32BIT_MACHINE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 32 bit word machine.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_DEBUG_STRIPPED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0200</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Debugging info stripped from file in .DBG file</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">   0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0400</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // If Image is on removable media, copy and run from the swap file.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_NET_RUN_FROM_SWAP</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0800</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // If Image is on Net, copy and run from the swap file.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_SYSTEM</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                    0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // System File.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_DLL</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // File is a DLL.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_UP_SYSTEM_ONLY</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // File should only be run on a UP machine</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_FILE_BYTES_REVERSED_HI</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">         0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Bytes of machine word are reversed.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>4C0105001413B3510000000000000000E0000201</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>13.3.5 NT头：可选头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯97</p><p>32位 224字节 224/16=14</p><p>64位 240字节 240/16=15</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>010B      Magic</span></span>
<span class="line"><span>09        MajorLinkerVersion</span></span>
<span class="line"><span>00        MinorLinkerVersion</span></span>
<span class="line"><span>00180000  SizeOfCode</span></span>
<span class="line"><span>00360000  SizeOfInitializedData</span></span>
<span class="line"><span>00000000  SizeOfUninitializedData</span></span>
<span class="line"><span>53220000  AddressOfEntryPoint</span></span>
<span class="line"><span>00100000  BaseOfCode</span></span>
<span class="line"><span>00300000  BaseOfData</span></span>
<span class="line"><span>00004000  ImageBase</span></span>
<span class="line"><span>00100000  SectionAlignment</span></span>
<span class="line"><span>00020000  FileAlignment</span></span>
<span class="line"><span>0500      MajorOperatingSystemVersion</span></span>
<span class="line"><span>0000      MinorOperatingSystemVersion</span></span>
<span class="line"><span>0000      MajorImageVersion</span></span>
<span class="line"><span>0000      MinorImageVersion</span></span>
<span class="line"><span>0500      MajorSubsystemVersion</span></span>
<span class="line"><span>0000      MinorSubsystemVersion</span></span>
<span class="line"><span>00000000  Win32VersionValue</span></span>
<span class="line"><span>00800000  SizeOfImage</span></span>
<span class="line"><span>00040000  SizeOfHeaders</span></span>
<span class="line"><span>BA1B0100  CheckSum</span></span>
<span class="line"><span>0200      Subsystem</span></span>
<span class="line"><span>4081      DllCharacteristics</span></span>
<span class="line"><span>00001000  SizeOfStackReserve</span></span>
<span class="line"><span>00100000  SizeOfStackCommit</span></span>
<span class="line"><span>00001000  SizeOfHeapReserve</span></span>
<span class="line"><span>00100000  SizeOfHeapCommit</span></span>
<span class="line"><span>00000000  LoaderFlags</span></span>
<span class="line"><span>10000000  NumberOfRvaAndSizes</span></span>
<span class="line"><span>00000000 00000000   DataDirectory0  VirtualAddress  Size</span></span>
<span class="line"><span>7C380000 78000000   DataDirectory1  VirtualAddress  Size</span></span>
<span class="line"><span>00500000 FC1F0000   DataDirectory2  VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory3  VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory4  VirtualAddress  Size</span></span>
<span class="line"><span>00700000 14030000   DataDirectory5  VirtualAddress  Size</span></span>
<span class="line"><span>50310000 1C000000   DataDirectory6  VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory7  VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory8  VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory9  VirtualAddress  Size</span></span>
<span class="line"><span>58370000 40000000   DataDirectory10 VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory11 VirtualAddress  Size</span></span>
<span class="line"><span>00300000 30010000   DataDirectory12 VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory13 VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory14 VirtualAddress  Size</span></span>
<span class="line"><span>00000000 00000000   DataDirectory15 VirtualAddress  Size</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Directory format.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_DATA_DIRECTORY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   VirtualAddress;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   Size;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_DATA_DIRECTORY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_DATA_DIRECTORY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_NUMBEROF_DIRECTORY_ENTRIES</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    16</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Optional header format.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_OPTIONAL_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Standard fields.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    Magic;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE    MajorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE    MinorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfInitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfUninitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   AddressOfEntryPoint;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   BaseOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   BaseOfData;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // NT additional fields.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   ImageBase;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SectionAlignment;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   FileAlignment;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MajorOperatingSystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MinorOperatingSystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MajorImageVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MinorImageVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MajorSubsystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    MinorSubsystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   Win32VersionValue;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfImage;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfHeaders;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   CheckSum;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    Subsystem;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    DllCharacteristics;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfStackReserve;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfStackCommit;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfHeapReserve;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfHeapCommit;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   LoaderFlags;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   NumberOfRvaAndSizes;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_DATA_DIRECTORY </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">DataDirectory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_OPTIONAL_HEADER32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_OPTIONAL_HEADER32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_ROM_OPTIONAL_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD   Magic;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE   MajorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE   MinorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  SizeOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  SizeOfInitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  SizeOfUninitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  AddressOfEntryPoint;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  BaseOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  BaseOfData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  BaseOfBss;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  GprMask;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">CprMask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD  GpValue;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_ROM_OPTIONAL_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_ROM_OPTIONAL_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_OPTIONAL_HEADER64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        Magic;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE        MajorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE        MinorLinkerVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SizeOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SizeOfInitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SizeOfUninitializedData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       AddressOfEntryPoint;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       BaseOfCode;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ULONGLONG   ImageBase;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SectionAlignment;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       FileAlignment;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MajorOperatingSystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MinorOperatingSystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MajorImageVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MinorImageVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MajorSubsystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        MinorSubsystemVersion;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       Win32VersionValue;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SizeOfImage;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       SizeOfHeaders;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       CheckSum;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        Subsystem;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD        DllCharacteristics;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ULONGLONG   SizeOfStackReserve;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ULONGLONG   SizeOfStackCommit;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ULONGLONG   SizeOfHeapReserve;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ULONGLONG   SizeOfHeapCommit;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       LoaderFlags;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD       NumberOfRvaAndSizes;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    IMAGE_DATA_DIRECTORY </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">DataDirectory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_OPTIONAL_HEADER64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_OPTIONAL_HEADER64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_NT_OPTIONAL_HDR32_MAGIC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">      0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10b</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_NT_OPTIONAL_HDR64_MAGIC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">      0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20b</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_ROM_OPTIONAL_HDR_MAGIC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">107</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> _WIN64</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> IMAGE_OPTIONAL_HEADER64             IMAGE_OPTIONAL_HEADER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PIMAGE_OPTIONAL_HEADER64            PIMAGE_OPTIONAL_HEADER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_NT_OPTIONAL_HDR_MAGIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         IMAGE_NT_OPTIONAL_HDR64_MAGIC</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#else</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> IMAGE_OPTIONAL_HEADER32             IMAGE_OPTIONAL_HEADER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PIMAGE_OPTIONAL_HEADER32            PIMAGE_OPTIONAL_HEADER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_NT_OPTIONAL_HDR_MAGIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         IMAGE_NT_OPTIONAL_HDR32_MAGIC</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在IMAGE_OPTIONAL_HEADER32结构体中需要关注下列成员。这些值是文件运行必需的，设置错误将导致文件无法正常运行。</p><p>#1. Magic 为IMAGE_OPTIONAL_HEADER32结构体时, Magic码为010B; 为IMAGE_OPTIONAL_HEADER64结构体时, Magic码为020B.</p><p>#2. AddressOfEntryPoint AddressOfEntryPoint持有EP的RVA值。该值指出程序最先执行的代码起始地址，相当重要。</p><p>#3. ImageBase 进程虚拟内存的范围是0~FFFFFFFF（32位系统）。PE文件被加载到如此大的内存中时，ImageBase指出文件的优先装入地址。 EXE、DLL文件被装载到用户内存的0~7FFFFFFF中，SYS文件被载入内核内存的80000000~FFFFFFFF中。一般而言，使用开发工具((V B / V C + \\rightarrow / D e l p h i)创建好EXE文件后，其ImageBase的值为00400000, DLL文件的ImageBase值为10000000（当然也可以指定为其他值）。执行PE文件时，PE装载器先创建进程，再将文件载入内存，然后把EIP寄存器的值设置为ImageBase+AddressOfEntryPoint.</p><p>#4. SectionAlignment, FileAlignment PE文件的Body部分划分为若干节区，这些节存储着不同类别的数据。FileAlignment指定了节区在磁盘文件中的最小单位，而SectionAlignment则指定了节区在内存中的最小单位(一个文件中, FileAlignment与SectionAlignment的值可能相同，也可能不同)。磁盘文件或内存的节区大小必定为FileAlignment或SectionAlignment值的整数倍。</p><p>#5. SizeOfImage 加载PE文件到内存时，SizeOfImage指定了PE Image在虚拟内存中所占空间的大小。一般而言，文件的大小与加载到内存中的大小是不同的（节区头中定义了各节装载的位置与占有内存的大小，后面会讲到）。</p><p>#6. SizeOfHeader SizeOfHeader用来指出整个PE头的大小。该值也必须是FileAlignment的整数倍。第一节区所在位置与SizeOfHeader距文件开始偏移的量相同。</p><p>#7. Subsystem 该Subsystem值用来区分系统驱动文件(<em>. sys)与普通的可执行文件(</em>. exe,*. dll).S</p><p>#8. NumberOfRvaAndSizes NumberOfRvaAndSizes用来指定DataDirectory(IMAGE OPTIONAL HEADER32结构体的最后一个成员)数组的个数。虽然结构体定义中明确指出了数组个数为IMAGE NUMBEROF DIRECTORY ENTRIES(16), 但是PE装载器通过查看NumberOfRvaAndSizes值来识别数组大小，换言之，数组大小也可能不是16.</p><p>#9. DataDirectory DataDirectory是由IMAGE_DATA_DIRECTORY结构体组成的数组，数组的每项都有被定义的值。代码13-7列出了各数组项。</p><p>13.3.6 节区头………………………………………………101</p><p>PE文件格式的设计者们决定把具有相似属性的数据统一保存在一个被称为“节区”的地方，然后需要把各节区属性记录在节区头中（节区属性中有文件/内存的起始位置、大小、访问权限等）。</p><p>IMAGE_SECTION_HEADER 40个字节</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>2E 74 65 78 74 00 00 00    Name</span></span>
<span class="line"><span>9E170000    Misc</span></span>
<span class="line"><span>00100000    VirtualAddress</span></span>
<span class="line"><span>00180000    SizeOfRawData</span></span>
<span class="line"><span>00040000    PointerToRawData</span></span>
<span class="line"><span>00000000    PointerToRelocations</span></span>
<span class="line"><span>00000000    PointerToLinenumbers</span></span>
<span class="line"><span>0000        NumberOfRelocations</span></span>
<span class="line"><span>0000        NumberOfLinenumbers</span></span>
<span class="line"><span>20000060    Characteristics</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Section header format.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SIZEOF_SHORT_NAME</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _IMAGE_SECTION_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    BYTE    </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[IMAGE_SIZEOF_SHORT_NAME];</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    union</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            DWORD   PhysicalAddress;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            DWORD   VirtualSize;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } Misc;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   VirtualAddress;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   SizeOfRawData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   PointerToRawData;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   PointerToRelocations;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   PointerToLinenumbers;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    NumberOfRelocations;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    WORD    NumberOfLinenumbers;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    DWORD   Characteristics;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IMAGE_SECTION_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PIMAGE_SECTION_HEADER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SIZEOF_SECTION_HEADER</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          40</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Section characteristics.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_REG                   0x00000000  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_DSECT                 0x00000001  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_NOLOAD                0x00000002  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_GROUP                 0x00000004  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_TYPE_NO_PAD</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000008</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_COPY                  0x00000010  // Reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_CNT_CODE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                   0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000020</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contains code.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_CNT_INITIALIZED_DATA</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">       0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000040</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contains initialized data.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_CNT_UNINITIALIZED_DATA</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">     0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000080</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contains uninitialized data.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_LNK_OTHER</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                  0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_LNK_INFO</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                   0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000200</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contains comments or some other type of information.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_TYPE_OVER                  0x00000400  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_LNK_REMOVE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                 0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00000800</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contents will not become part of image.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_LNK_COMDAT</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                 0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00001000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contents comdat.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//                                           0x00002000  // Reserved.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_MEM_PROTECTED - Obsolete   0x00004000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_NO_DEFER_SPEC_EXC</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">          0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00004000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Reset speculative exceptions handling bits in the TLB entries for this section.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_GPREL</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                      0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00008000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section content can be accessed relative to GP</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_FARDATA</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00008000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//      IMAGE_SCN_MEM_SYSHEAP  - Obsolete    0x00010000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_PURGEABLE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00020000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_16BIT</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                  0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00020000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_LOCKED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                 0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00040000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_PRELOAD</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00080000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_1BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00100000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_2BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00200000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_4BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00300000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_8BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">               0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00400000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_16BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00500000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Default alignment if no others are specified.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_32BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00600000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_64BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00700000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_128BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00800000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_256BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00900000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_512BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00A00000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_1024BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00B00000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_2048BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00C00000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_4096BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00D00000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_8192BYTES</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00E00000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Unused                                    0x00F00000</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_ALIGN_MASK</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                 0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00F00000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_LNK_NRELOC_OVFL</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section contains extended relocations.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_DISCARDABLE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">            0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">02000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section can be discarded.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_NOT_CACHED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">             0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">04000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is not cachable.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_NOT_PAGED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">              0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">08000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is not pageable.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_SHARED</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                 0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is shareable.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_EXECUTE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is executable.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_READ</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                   0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is readable.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IMAGE_SCN_MEM_WRITE</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">                  0x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80000000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Section is writeable.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IMAGE_SECTION_HEADER结构体中要了解的重要成员（不使用其他成员）。 IMAGE_SECTION_HEADER结构体的重要成员</p><ul><li>VirtualSize 内存中节区所占大小</li><li>VirtualAddress 内存中节区起始地址 (RVA)</li><li>SizeOfRawData 磁盘文件中节区所占大小</li><li>PointerToRawData 磁盘文件中节区起始位置</li><li>Charateristics 节区属性 (bit OR)</li></ul><p>VirtualAddress与PointerToRawData不带有任何值，分别由(定义在IMAGE OPTIONAL HEADER32中的) SectionAlignment与FileAlignment确定。 VirtualSize与SizeOfRawData一般具有不同的值，即磁盘文件中节区的大小与加载到内存中的节区大小是不同的。 Characterisitics由代码13-10中显示的值组合(bit OR) 而成。 Name字段，Name成员不像C语言中的字符串一样以NULL结束，并且没有“必须使用ASCII值”的限制。PE规范未明确规定节区的Name，所以可以向其中放入任何值，甚至可以填充NULL值。所以节区的Name仅供参考，不能保证其百分之百地被用作某种信息（数据节区的名称也可叫做. code）.</p><p>提示</p><ul><li>讲解PE文件时经常出现“映像”(Image)这一术语，希望各位牢记。PE文件加载到内存时，文件不会原封不动地加载，而要根据节区头中定义的节区起始地址、节区大小等加载。因此，磁盘文件中的PE与内存中的PE具有不同形态。将装载到内存中的形态称为“映像”以示区别，使用这一术语能够很好地区分二者。</li></ul><p>13.4 RVA to RAW⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯104</p><p>PE文件加载到内存时，每个节区都要能准确完成内存地址与文件偏移间的映射。 这种映射一般称为RVA to RAW,方法如下。</p><ul><li>(1)查找RVA所在节区。</li><li>(2)使用简单的公式计算文件偏移 (RAW).</li></ul><p>根据IMAGE SECTION HEADER结构体，换算公式如下：</p><ul><li>RAW - PointerToRawData = RVA - VirtualAddress</li><li>RAW = RVA - VirtualAddress + PointerToRawData</li></ul><p>13.5 IAT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯105</p><p>13.5.1 DLL…………………………………………………105</p><p>13.5.2 IMAGE IMPORT DESCRIPTOR………………………………107</p><p>13.5.3 使用notepad. exe练习⋯⋯⋯⋯⋯⋯108</p><p>13.6 EAT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯112</p><p>13.6.1 IMAGE EXPORT DIRECTORY………………………………113 13.6.2 使用kernel32. dll练习………………114 13.7 高级PE⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯116 13.7.1 PEView.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 116 13.7.2 Patched PE⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯117 13.8 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯118</p><h3 id="第14章运行时压缩⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯121" tabindex="-1"><a class="header-anchor" href="#第14章运行时压缩⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯121"><span>第14章 运行时压缩⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯121</span></a></h3><p>14.1 数据压缩⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯121 14.1.1 无损压缩…………………………………………121 14.1.2 有损压缩……………………………………………121 14.2 运行时压缩器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯122 14.2.1 压缩器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯122 14.2.2 保护器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯123 14.3 运行时压缩测试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯123</p><h3 id="第15章调试upx压缩的notepad-程序⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯127" tabindex="-1"><a class="header-anchor" href="#第15章调试upx压缩的notepad-程序⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯127"><span>第15章 调试UPX压缩的notepad 程序⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯127</span></a></h3><p>15.1 notepad. exe的EP代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯127 15.2 notepad upx. exe的EP代码⋯⋯⋯⋯⋯⋯⋯⋯127 15.3 跟踪UPX文件⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯129 15.3.1 OllyDbg的跟踪命令⋯⋯⋯⋯⋯⋯⋯129 15.3.2 循环#1⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯129 15.3.3 循环#2⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯130 15.3.4 循环#3………………………………………………131 15.3.5 循环#4⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯131 15.4快速查找UPX OEP的方法⋯⋯⋯⋯⋯⋯⋯⋯132 15.4.1 在POPAD指令后的JMP 指令处设置断点⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯132 15.4.2 在栈中设置硬件断点⋯⋯⋯⋯⋯⋯⋯133 15.5 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯133</p><h3 id="第16章基址重定位表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯135" tabindex="-1"><a class="header-anchor" href="#第16章基址重定位表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯135"><span>第16章 基址重定位表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯135</span></a></h3><p>16.1 PE重定位⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯135 16.1.1 DLL/SYS⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯135 16.1.2 EXE⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯136 16.2 PE重定位时执行的操作⋯⋯⋯⋯⋯⋯⋯⋯⋯136 16.3 PE重定位操作原理⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯138 16.3.1 基址重定位表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯138 16.3.2 IMAGE BASE RELOCATION 结构体⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯139 16.3.3 基址重定位表的分析方法……139 16.3.4 练习⋯⋯⋯⋯⋯⋯⋯⋯141</p><h3 id="第17章从可执行文件中删除-reloc" tabindex="-1"><a class="header-anchor" href="#第17章从可执行文件中删除-reloc"><span>第17章 从可执行文件中删除. reloc</span></a></h3><p>节区⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯142 17.1 . reloc节区⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯142 17.2 reloc.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 142 17.2.1 删除. reloc节区头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯142 17.2.2 删除. reloc节区⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯143 17.2.3 修改IMAGE FILE HEADER…………………………………………143 17.2.4修改IMAGE OPTIONAL HEADER⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯144 17.3 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯145</p><h3 id="第18章-upack-pe文件头详细分析⋯⋯⋯146" tabindex="-1"><a class="header-anchor" href="#第18章-upack-pe文件头详细分析⋯⋯⋯146"><span>第18章 UPack PE文件头详细分析⋯⋯⋯146</span></a></h3><p>18.1 UPack说明⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯146 18.2 使用UPack压缩notepad. exe…………………146 18.3 使用Stud PE工具⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯148 18.4 比较PE文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯148 18.4.1 原notepad. exe的PE文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯149 18.4.2 notepad upack. exe运行时压缩的PE文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯ 149 18.5 分析UPack的PE文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯150 18.5.1 重叠文件头⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯150 18.5.2 IMAGE FILE HEADER.SizeOfOptionalHeader⋯⋯⋯⋯⋯⋯ 150 18.5.3 IMAGE OPTIONAL HEADER. NumberOfRvaAndSizes……………………………………152 18.5.4 IMAGE SECTION HEADER⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯153 18.5.5 重叠节区⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯155 18.5.6 RVA to RAW⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯156 18.5.7 导入表 (IMAGE IMPORT DESCRIPTOR array)…………………158 18.5.8 导入地址表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯160 18.6 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯161</p><h3 id="第19章-upack调试-查找oep⋯⋯⋯⋯⋯⋯162" tabindex="-1"><a class="header-anchor" href="#第19章-upack调试-查找oep⋯⋯⋯⋯⋯⋯162"><span>第19章 UPack调试-查找OEP⋯⋯⋯⋯⋯⋯162</span></a></h3><p>19.1 OllyDbg运行错误⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯162 19.2 解码循环⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯163 19.3 设置IAT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 165 19.4 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯166</p><h3 id="第20章-内嵌补丁-练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯167" tabindex="-1"><a class="header-anchor" href="#第20章-内嵌补丁-练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯167"><span>第20章 “内嵌补丁”练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯167</span></a></h3><p>20.1 内嵌补丁⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯167 20.2 练习：Patchme………………………………………………168 20.3 调试：查看代码流……………………………………………168 20.4 代码结构⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯172 20.5 “内嵌补丁”练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯173 20.5.1 补丁代码要设置在何处呢⋯⋯⋯173 20.5.2 制作补丁代码……………………………………175 20.5.3 执行补丁代码…………………………………176 20.5.4 结果确认……………………………………………177</p><h2 id="第三部分-dll注入" tabindex="-1"><a class="header-anchor" href="#第三部分-dll注入"><span>第三部分 DLL注入</span></a></h2><h3 id="第21章-windows消息钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯180" tabindex="-1"><a class="header-anchor" href="#第21章-windows消息钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯180"><span>第21章 Windows消息钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯180</span></a></h3><p>21.1 钩子⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯180 21.2 消息钩子⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯180 21.3 SetWindowsHookEx()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯181 21.4 键盘消息钩取练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯182 21.4.1 练习示例HookMain. exe⋯⋯⋯⋯182 21.4.2 分析源代码………………………………………185 21.5 调试练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯187 21.5.1 调试HookMain. exe⋯⋯⋯⋯⋯⋯⋯⋯188 21.5.2 调试Notepad. exe进程内的 KeyHook. dll⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 190 21.6 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯192</p><h3 id="第22章恶意键盘记录器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194" tabindex="-1"><a class="header-anchor" href="#第22章恶意键盘记录器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194"><span>第22章 恶意键盘记录器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194</span></a></h3><p>22.1 恶意键盘记录器的目标⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194 22.1.1 在线游戏⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194 22.1.2 网上银行⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194 22.1.3 商业机密泄露⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯194 22.2 键盘记录器的种类与发展趋势⋯⋯⋯⋯⋯⋯195 22.3 防范恶意键盘记录器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯195 22.4 个人信息⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯195</p><h3 id="第23章-dll注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯197" tabindex="-1"><a class="header-anchor" href="#第23章-dll注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯197"><span>第23章 DLL注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯197</span></a></h3><p>23.1 DLL注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯197 23.2 DLL注入示例⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯198 23.2.1 改善功能与修复Bug⋯⋯⋯⋯⋯⋯⋯ 198 23.2.2 消息钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯198 23.2.3 API钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯198 23.2.4 其他应用程序⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯199 23.2.5 恶意代码……………………………………………199 23.3 DLL注入的实现方法⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯199 23.4 CreateRemoteThread()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯199 23.4.1 练习示例myhack. dll……………………199 23.4.2 分析示例源代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯203 23.4.3 调试方法⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯208 23.5 AppInit DLLs⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯210 23.5.1 分析示例源码…………………………………211 23.5.2 练习示例myhack2. dll………………212 23.6 SetWindowsHookEx()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯214 23.7 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯214</p><h3 id="第24章-dll卸载-216" tabindex="-1"><a class="header-anchor" href="#第24章-dll卸载-216"><span>第24章 DLL卸载………………………………………………216</span></a></h3><p>24.1 DLL卸载的工作原理⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯216 24.2 实现DLL卸载⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯216 24.2.1 获取进程中加载的DLL信息…219 24.2.2 获取目标进程的句柄…………………220 24.2.3 获取FreeLibrary()API地址……220 24.2.4 在目标进程中运行线程……………220 24.3 DLL卸载练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯220 24.3.1 复制文件及运行notepad. exe…220 24.3.2 注入myhack. dll……………………………221 24.3.3 卸载myhack.dll⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 222</p><h3 id="第25章通过修改pe加载dll-224" tabindex="-1"><a class="header-anchor" href="#第25章通过修改pe加载dll-224"><span>第25章 通过修改PE加载DLL…………………224</span></a></h3><p>25.1 练习文件⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯224 25.1.1 TextView.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 224 25.1.2 TextView patched.exe⋯⋯⋯⋯⋯⋯⋯ 225 25.2 源代码-myhack3. cpp…………………………………227 25.2.1 DllMain()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯227 25.2.2 DownloadURL()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯228 25.2.3 DropFile()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯229 25.2.4 dummy()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯230 25.3 修改TextView. exe文件的准备工作⋯⋯231 25.3.1 修改思路⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯231 25.3.2 查看IDT是否有足够空间……231 25.3.3 移动IDT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯233 25.4 修改TextView.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 235 25.4.1 修改导入表的RVA值⋯⋯⋯⋯⋯⋯235 25.4.2 删除绑定导入表……………………………235 25.4.3 创建新IDT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯235 25.4.4 设置Name、INT、IAT⋯⋯⋯⋯⋯236 25.4.5 修改IAT节区的属性值……………238 25.5 检测验证⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯240 25.6 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯241</p><h3 id="第26章-pe-tools·-242" tabindex="-1"><a class="header-anchor" href="#第26章-pe-tools·-242"><span>第26章 PE Tools· …………………………………………242</span></a></h3><p>26.1 PE Tools⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯242 26.1.1 进程内存转储⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯243 26.1.2 PE编辑器…………………………………………245 26.2 小结……………………………………………………………………245</p><h3 id="第27章代码注入-247" tabindex="-1"><a class="header-anchor" href="#第27章代码注入-247"><span>第27章 代码注入……………………………………………247</span></a></h3><p>27.1 代码注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯247 27.2 DLL注入与代码注入⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯247 27.3 练习示例⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯249 27.3.1 运行notepad.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 249 27.3.2 运行CodeInjection.exe⋯⋯⋯⋯⋯ 249 27.3.3 弹出消息框⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯250 27.4 CodeInjection. cpp⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯250 27.4.1 main()函数…………………………………………251 27.4.2 ThreadProc()函数⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯251 27.4.3 InjectCode()函数⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯254 27.5 代码注入调试练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯256 27.5.1 调试notepad. exe……………………………256 27.5.2 设置OllyDbg选项………………………256 27.5.3 运行CodeInjection.exe⋯⋯⋯⋯⋯⋯ 257 27.5.4 线程开始代码……………………………………258 27.6 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯259</p><h3 id="第第28章使用汇编语言编写注入代码-260" tabindex="-1"><a class="header-anchor" href="#第第28章使用汇编语言编写注入代码-260"><span>第第28章 使用汇编语言编写注入代码……260</span></a></h3><p>28.1 目标⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯260 28.2 汇编编程⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯260 28.3 OllyDbg的汇编命令………………………………………260 28.3.1 编写ThreadProc()函数…………………262 28.3.2 保存文件……………………………………………265 28.4 编写代码注入程序⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯266 28.4.1 获取ThreadProc()函数的二进制代码………………………………………266 28.4.2 CodeInjection2. cpp…………………………267 28.5 调试练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯270 28.5.1 调试notepad.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 270 28.5.2 设置OllyDbg选项⋯⋯⋯⋯⋯⋯⋯⋯⋯270 28.5.3 运行CodeInjection2.exe⋯⋯⋯⋯⋯ 271 28.5.4 线程起始代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯272 28.6 详细分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯272 28.6.1 生成栈帧………………………………………………272 28.6.2 THREAD PARAM结构体指针…………………………………………………………273 28.6.3 &quot;User32. dll&quot;字符串⋯⋯⋯⋯⋯⋯⋯⋯274 28.6.4 压入“user32. dll”字符串参数……………………………………………………274 28.6.5 调用LoadLibraryA(&quot;user32. dll&quot;)………………………………………275 28.6.6 &quot;MessageBoxA&quot;字符串⋯⋯⋯⋯276 28.6.7 调用 GetProcAddress(hMod,&quot;MessageBoxA&quot;)…………………………276 28.6.8 压入MessageBoxA()函数的参数1-MB OK……………………………277 28.6.9 压入MessageBoxA()函数的参数2- &quot;ReverseCore&quot;…………277 28.6.10 压入MessageBoxA()函数的参数3-&quot;www.reversecore.com&quot;……………………………………………278 28.6.11 压入MessageBoxA()函数的参数4-NULL………………………………279 28.6.12 调用MessageBoxA()………………279 28.6.13 设置ThreadProc()函数的 返回值………………………………………………280 28.6.14 删除栈帧及函数返回⋯⋯⋯⋯⋯⋯280 28.7 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯280</p><h2 id="第四部分-api钩取" tabindex="-1"><a class="header-anchor" href="#第四部分-api钩取"><span>第四部分 API钩取</span></a></h2><h3 id="第29章-api钩取-逆向分析之-花-282" tabindex="-1"><a class="header-anchor" href="#第29章-api钩取-逆向分析之-花-282"><span>第29章 API钩取：逆向分析之“花”…282</span></a></h3><p>29.1 钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯282 29.2 API是什么⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯282 29.3 API钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯283 29.3.1 正常调用API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯283 29.3.2 钩取API调用⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯284 29.4 技术图表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯284 29.4.1 方法对象（是什么）…………………285 29.4.2 位置（何处）⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯285 29.4.3 技术（如何）⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯286 29.4.4 API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯286</p><h3 id="第30章记事本writefile-api钩取-288" tabindex="-1"><a class="header-anchor" href="#第30章记事本writefile-api钩取-288"><span>第30章 记事本WriteFile()API钩取……288</span></a></h3><p>30.1 技术图表-调试技术⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯288 30.2 关于调试器的说明⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯289 30.2.1 术语⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯289 30.2.2 调试器功能⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯289 30.2.3 调试器的工作原理⋯⋯⋯⋯⋯⋯⋯⋯⋯289 30.2.4 调试事件…………………………………………289 30.3 调试技术流程⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯290 30.4 练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯291 30.5 工作原理⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯293 30.5.1 栈⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯293 30.5.2 执行流⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯295 30.5.3 “脱钩”&amp;“钩子”⋯⋯⋯⋯⋯⋯⋯⋯⋯295 30.6 源代码分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯295 30.6.1 main()…………………………………………………296 30.6.2 DebugLoop()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯296 30.6.3 EXIT PROCESS DEBUG EVENT⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯298 30.6.4 CREATE PROCESS DEBUG EVENT-OnCreateProcessDebugEvent()·· ………………………298 30.6.5 EXCEPTION DEBUG EVENT-OnExceptionDebugEvent()·· …………………300</p><h3 id="第31章关于调试器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯305" tabindex="-1"><a class="header-anchor" href="#第31章关于调试器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯305"><span>第31章 关于调试器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯305</span></a></h3><p>31.1 OllyDbg⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯305 31.2 IDA Pro⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 305 31.3 WinDbg⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯306</p><h3 id="第32章计算器显示中文数字⋯⋯⋯⋯⋯⋯⋯⋯308" tabindex="-1"><a class="header-anchor" href="#第32章计算器显示中文数字⋯⋯⋯⋯⋯⋯⋯⋯308"><span>第32章 计算器显示中文数字⋯⋯⋯⋯⋯⋯⋯⋯308</span></a></h3><p>32.1 技术图表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯308 32.2 选定目标API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯309 32.3 IAT钩取工作原理⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯312 32.4 练习示例⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯314 32.5 源代码分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯316 32.5.1 DllMain()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯316 32.5.2 MySetWindowTextW()………………317 32.5.3 hook iat()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯319 32.6 调试被注入的DLL文件⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯322 32.6.1 DllMain()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯325 32.6.2 hook iat()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯325 32.6.3 MySetWindowTextW()⋯⋯⋯⋯⋯⋯327 32.7 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯328</p><h3 id="第33章隐藏进程⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯329" tabindex="-1"><a class="header-anchor" href="#第33章隐藏进程⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯329"><span>第33章 隐藏进程⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯329</span></a></h3><p>33.1 技术图表⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯329 33.2 API代码修改技术的原理⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯329 33.2.1 钩取之前⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯330 33.2.2 钩取之后⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯330 33.3 进程隐藏⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯332 33.3.1 进程隐藏工作原理⋯⋯⋯⋯⋯⋯⋯⋯332 33.3.2 相关API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯332 33.3.3 隐藏技术的问题……………………………333 33.4 练习#1(HideProc. exe, stealth. dll)…333 33.4.1 运行notepad. exe、procexp. exe、taskmgr.exe⋯⋯ 334 33.4.2 运行HideProc.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 334 33.4.3 确认stealth. dll注入成功……………334 33.4.4 查看notepad. exe进程是否隐藏成功⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯335 33.4.5 取消notepad. exe进程隐藏……336 33.5 源代码分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯336 33.5.1 HideProc. cpp⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯336 33.5.2 stealth. cpp……………………………………………338 33.6 全局API钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯344 33.6.1 Kernel32. CreateProcess()API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯344 33.6.2 Ntdll. ZwResumeThread()API………………………………………………………………345 33.7 练习#2(HideProc2. exe,Stealth2. dll)……345 33.7.1 复制stealth2. dll文件到%SYSTEM%文件夹中…………………345 33.7.2 运行HideProc2. exe-hide⋯⋯⋯⋯346 33.7.3 运行ProcExp. exe&amp;notepad.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 346 33.7.4 运行HideProc2. exe-show…………347 33.8 源代码分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯348 33.8.1 HideProc2. cpp……………………………………348 33.8.2 stealth2. cpp…………………………………………348 33.9 利用“热补丁”技术钩取API⋯⋯⋯⋯⋯⋯⋯350 33.9.1 API代码修改技术的问题⋯⋯⋯350 33.9.2 “热补丁”（修改7个字节代码）⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯350 33.10 练习#3: stealth3. dll……………………………………353 33.11 源代码分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯353 33.12 使用“热补丁”API钩取技术时需要考虑的问题⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯356 33.13 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯357</p><h3 id="第34章高级全局api钩取-ie连接控制⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯359" tabindex="-1"><a class="header-anchor" href="#第34章高级全局api钩取-ie连接控制⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯359"><span>第34章 高级全局API钩取：IE连接控制⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯359</span></a></h3><p>34.1 目标API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯359 34.2 IE进程结构⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯361 34.3 关于全局API钩取的概念⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯362 34.3.1 常规API钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯363 34.3.2 全局API钩取⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯363 34.4 ntdll!ZwResumeThread()API⋯⋯⋯⋯⋯⋯⋯⋯364 34.5 练习示例：控制IE网络连接⋯⋯⋯⋯⋯⋯⋯⋯368 34.5.1 运行IE⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯368 34.5.2 注入DLL………………………………………369 34.5.3 创建新选项卡⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯369 34.5.4 尝试连接网站………………………………370 34.5.5 卸载DLL………………………………………371 34.5.6 课外练习⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯372 34.6 示例源代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯372 34.6.1 DllMain()⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯372 34.6.2 NewInternetConnectW()⋯⋯⋯⋯⋯373 34.6.3 NewZwResumeThread()……………374 34.7 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯375</p><h3 id="第35章优秀分析工具的五种标准⋯⋯⋯⋯376" tabindex="-1"><a class="header-anchor" href="#第35章优秀分析工具的五种标准⋯⋯⋯⋯376"><span>第35章 优秀分析工具的五种标准⋯⋯⋯⋯376</span></a></h3><p>35.1 工具⋯376 35.2 代码逆向分析工程师⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯376 35.3 优秀分析工具的五种标准⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯376 35.3.1 精简工具数量⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯377 35.3.2 工具功能简单、使用方便……377</p><p>35.3.3 完全掌握各种功能⋯⋯⋯⋯⋯⋯⋯⋯377 35.3.4 不断升级更新………………………………377 35.3.5 理解工具的核心工作原理……377 35.4 熟练程度的重要性⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯377</p><h2 id="第五部分-64位-windows内核6" tabindex="-1"><a class="header-anchor" href="#第五部分-64位-windows内核6"><span>第五部分 64位&amp; Windows内核6</span></a></h2><h3 id="第36章-64位计算⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯380" tabindex="-1"><a class="header-anchor" href="#第36章-64位计算⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯380"><span>第36章 64位计算⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯380</span></a></h3><p>36.1 64位计算环境⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯380 36.1.1 64位CPU⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯380 36.1.2 64位OS⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯381 36.1.3 Win32 API⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯381 36.1.4 WOW64⋯⋯⋯⋯⋯⋯⋯381 36.1.5 练习：WOW64Test⋯⋯⋯⋯⋯⋯⋯384 36.2 编译64位文件⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯385 36.2.1 Microsoft Windows SDK(Software Development Kit)……386 36.2.2 设置Visual C++2010 Express环境………………………………………………………386</p><h3 id="第37章-x64处理器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389" tabindex="-1"><a class="header-anchor" href="#第37章-x64处理器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389"><span>第37章 x64处理器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389</span></a></h3><p>37.1 x64中新增或变更的项目⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389 37.1.1 64位⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389 37.1.2 内存⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389 37.1.3 通用寄存器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯389 37.1.4 CALL/JMP指令⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯390 37.1.5 函数调用约定⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯391 37.1.6 栈&amp;栈帧⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯392 37.2 练习：Stack32. exe&amp; Stack64.exe⋯⋯⋯ 392 37.2.1 Stack32.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 392 37.2.2 Stack64.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 394 37.3 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯397</p><h3 id="第38章-pe32-398" tabindex="-1"><a class="header-anchor" href="#第38章-pe32-398"><span>第38章 PE32+ ………………398</span></a></h3><p>38.1PE32+ (PE+、PE64)⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯398 38.1.1 IMAGE NT HEADERS⋯⋯⋯⋯398 38.1.2 IMAGE FILE HEADER⋯⋯⋯398 38.1.3 IMAGE OPTIONAL HEADER⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯399 38.1.4 IMAGE THUNK DATA⋯⋯⋯401 38.1.5 IMAGE TLS DIRECTORY…403</p><h3 id="第39章-windbg·-405" tabindex="-1"><a class="header-anchor" href="#第39章-windbg·-405"><span>第39章 WinDbg· ……………405</span></a></h3><p>39.1 WinDbg· ………………………………………405 39.1.1 WinDbg的特征⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯405 39.1.2 运行WinDbg⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯406</p><p>39.1.3 内核调试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯407 39.1.4 WinDbg基本指令⋯⋯⋯⋯⋯⋯⋯⋯⋯409</p><h3 id="第40章-64位调试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯411" tabindex="-1"><a class="header-anchor" href="#第40章-64位调试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯411"><span>第40章 64位调试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯411</span></a></h3><p>40.1 x64环境下的调试器⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯411 40.2 64位调试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯411 40.3 PE32: WOW64Test x86. exe⋯⋯⋯⋯⋯⋯⋯413 40.3.1 EP代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯414 40.3.2 Startup代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯414 40.3.3 main()函数⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯415 40.4 PE32+: WOW64Test x64.exe⋯⋯⋯⋯⋯⋯ 416 40.4.1 系统断点⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯416 40.4.2 EP代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯417 40.4.3 Startup代码⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯418 40.4.4 main()函数………………………………………420 40.5 小结⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯423</p><h3 id="第41章-aslr⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424" tabindex="-1"><a class="header-anchor" href="#第41章-aslr⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424"><span>第41章 ASLR⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424</span></a></h3><p>41.1 Windows内核版本⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424 41.2 ASLR⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424 41.3 Visual C++⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯424 41.4 ASLR.exe⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 425 41.4.1 节区信息⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯426 41.4.2 IMAGE FILE HEADER\\Characteristics⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯427 41.4.3 IMAGE OPTIONAL HEADER\\DLL Characteristics⋯⋯⋯⋯⋯⋯⋯⋯⋯428 41.5 练习：删除ASLR功能⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯428</p><h3 id="第42章内核6中的会话-430" tabindex="-1"><a class="header-anchor" href="#第42章内核6中的会话-430"><span>第42章 内核6中的会话………………………………430</span></a></h3><p>42.1 会话⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯430 42.2 会话0隔离机制⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯432 42.3 增强安全性⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯432</p><h3 id="第43章内核6中的dll注入⋯⋯⋯⋯⋯⋯⋯⋯433" tabindex="-1"><a class="header-anchor" href="#第43章内核6中的dll注入⋯⋯⋯⋯⋯⋯⋯⋯433"><span>第43章 内核6中的DLL注入⋯⋯⋯⋯⋯⋯⋯⋯433</span></a></h3><p>43.1 再现DLL注入失败⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯433 43.1.1 源代码…………………………………………………433 43.1.2 注入测试⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯435 43.2 原因分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯436 43.2.1 调试#1⋯⋯⋯⋯⋯⋯⋯436 43.2.2 调试#2⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯438 43.3 练习：使CreateRemoteThread()正常工作⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯440 43.3.1 方法#1: 修改CreateSuspended参数值⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯440 43.3.2 方法#2: 操纵条件分支……………441</p><h2 id="windows-visual-studio-的常用命令-例如-编译、连接、生成可执行文件等等" tabindex="-1"><a class="header-anchor" href="#windows-visual-studio-的常用命令-例如-编译、连接、生成可执行文件等等"><span>Windows Visual Studio 的常用命令，例如：编译、连接、生成可执行文件等等</span></a></h2><p>在 <strong>Windows Visual Studio</strong> 环境中，常用的命令涉及编译、链接、构建项目等操作。这些命令可以通过 <strong>Visual Studio 命令行工具</strong>（如 <code>Developer Command Prompt</code> 或 <code>Developer PowerShell</code>）执行，也可以集成到脚本中实现自动化构建。以下是核心命令及其用途和示例：</p><hr><h3 id="一、核心命令行工具" tabindex="-1"><a class="header-anchor" href="#一、核心命令行工具"><span><strong>一、核心命令行工具</strong></span></a></h3><h4 id="_1-msbuild-项目构建工具" tabindex="-1"><a class="header-anchor" href="#_1-msbuild-项目构建工具"><span><strong>1. <code>MSBuild</code>（项目构建工具）</strong></span></a></h4><ul><li><strong>作用</strong>：用于构建 <code>.sln</code> 解决方案文件或 <code>.vcxproj</code> 项目文件。</li><li><strong>常用命令</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 构建整个解决方案（默认配置）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MSBuild</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MySolution.sln</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定配置（Debug/Release）和平台（x86/x64）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MSBuild</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MySolution.sln</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /p:Configuration=Release</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /p:Platform=x64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 仅构建指定项目</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MSBuild</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MyProject.vcxproj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /t:Build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_2-cl-exe-c-c-编译器" tabindex="-1"><a class="header-anchor" href="#_2-cl-exe-c-c-编译器"><span><strong>2. <code>cl.exe</code>（C/C++ 编译器）</strong></span></a></h4><ul><li><strong>作用</strong>：编译 C/C++ 源文件（<code>.cpp</code>、<code>.c</code>）生成对象文件（<code>.obj</code>）。</li><li><strong>常用命令</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译单个文件（默认生成同名 .obj）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.cpp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定输出文件名和优化选项</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /O2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Fomain.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.cpp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 多文件编译（生成多个 .obj）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file1.cpp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file2.cpp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-link-exe-链接器" tabindex="-1"><a class="header-anchor" href="#_3-link-exe-链接器"><span><strong>3. <code>link.exe</code>（链接器）</strong></span></a></h4><ul><li><strong>作用</strong>：将对象文件（<code>.obj</code>）和库文件（<code>.lib</code>）链接为可执行文件（<code>.exe</code>）或动态库（<code>.dll</code>）。</li><li><strong>常用命令</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 链接生成可执行文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> utils.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /OUT:MyApp.exe</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 链接动态库（生成 .dll）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /DLL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> math.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /OUT:MathLibrary.dll</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定依赖库（如 Windows API）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user32.lib</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gdi32.lib</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /OUT:MyApp.exe</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h3 id="二、常用编译和链接参数" tabindex="-1"><a class="header-anchor" href="#二、常用编译和链接参数"><span><strong>二、常用编译和链接参数</strong></span></a></h3><h4 id="_1-编译器参数-cl-exe" tabindex="-1"><a class="header-anchor" href="#_1-编译器参数-cl-exe"><span><strong>1. 编译器参数（<code>cl.exe</code>）</strong></span></a></h4><table><thead><tr><th><strong>参数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>/c</code></td><td>仅编译，不链接（生成 <code>.obj</code> 文件）</td></tr><tr><td><code>/O1</code>, <code>/O2</code>, <code>/Ox</code></td><td>优化等级（最小体积、最大速度、全优化）</td></tr><tr><td><code>/I&lt;目录&gt;</code></td><td>添加头文件搜索目录（如 <code>/I&quot;C:\\MyLib\\include&quot;</code>）</td></tr><tr><td><code>/D&lt;宏&gt;</code></td><td>定义预处理器宏（如 <code>/DDEBUG</code>）</td></tr><tr><td><code>/EHsc</code></td><td>启用 C++ 异常处理（必须用于包含异常的代码）</td></tr></tbody></table><h4 id="_2-链接器参数-link-exe" tabindex="-1"><a class="header-anchor" href="#_2-链接器参数-link-exe"><span><strong>2. 链接器参数（<code>link.exe</code>）</strong></span></a></h4><table><thead><tr><th><strong>参数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>/OUT:&lt;文件名&gt;</code></td><td>指定输出文件名（默认基于第一个输入文件）</td></tr><tr><td><code>/LIBPATH:&lt;目录&gt;</code></td><td>添加库文件搜索目录（如 <code>/LIBPATH:&quot;C:\\MyLib\\lib&quot;</code>）</td></tr><tr><td><code>/SUBSYSTEM:CONSOLE</code></td><td>控制台应用程序（显示命令行窗口）</td></tr><tr><td><code>/SUBSYSTEM:WINDOWS</code></td><td>GUI 应用程序（不显示命令行窗口）</td></tr><tr><td><code>/DEBUG</code></td><td>生成调试信息（需与 <code>/Zi</code> 编译选项配合）</td></tr></tbody></table><hr><h3 id="三、完整构建流程示例" tabindex="-1"><a class="header-anchor" href="#三、完整构建流程示例"><span><strong>三、完整构建流程示例</strong></span></a></h3><h4 id="_1-手动编译链接" tabindex="-1"><a class="header-anchor" href="#_1-手动编译链接"><span><strong>1. 手动编译链接</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译源文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /EHsc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Iinclude</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /O2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ain.cpp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tils.cpp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 链接生成可执行文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> utils.obj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /OUT:MyApp.exe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /LIBPATH:lib</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user32.lib</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-使用-devenv-命令-集成-ide-功能" tabindex="-1"><a class="header-anchor" href="#_2-使用-devenv-命令-集成-ide-功能"><span><strong>2. 使用 <code>devenv</code> 命令（集成 IDE 功能）</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 构建解决方案（不打开 IDE）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">devenv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MySolution.sln</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Release|x64&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清理项目</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">devenv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MySolution.sln</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Clean</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="四、实用环境配置" tabindex="-1"><a class="header-anchor" href="#四、实用环境配置"><span><strong>四、实用环境配置</strong></span></a></h3><h4 id="_1-设置环境变量" tabindex="-1"><a class="header-anchor" href="#_1-设置环境变量"><span><strong>1. 设置环境变量</strong></span></a></h4><ul><li>运行 <code>Developer Command Prompt</code> 或 <code>Developer PowerShell</code>，它们已自动配置以下路径： <ul><li><strong>编译器/链接器路径</strong>：如 <code>C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.30.30705\\bin\\Hostx64\\x64</code>。</li><li><strong>库和头文件路径</strong>：自动包含 Windows SDK 和 CRT 路径。</li></ul></li></ul><h4 id="_2-查看工具版本" tabindex="-1"><a class="header-anchor" href="#_2-查看工具版本"><span><strong>2. 查看工具版本</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 cl.exe 版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 link.exe 版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="五、进阶工具与场景" tabindex="-1"><a class="header-anchor" href="#五、进阶工具与场景"><span><strong>五、进阶工具与场景</strong></span></a></h3><h4 id="_1-nmake-makefile-构建" tabindex="-1"><a class="header-anchor" href="#_1-nmake-makefile-构建"><span><strong>1. <code>nmake</code>（Makefile 构建）</strong></span></a></h4><ul><li><strong>作用</strong>：通过 <code>Makefile</code> 文件管理构建流程。</li><li><strong>示例</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 生成 Makefile（需编写规则）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nmake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MyMakefile.mak</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_2-vcpkg-包管理" tabindex="-1"><a class="header-anchor" href="#_2-vcpkg-包管理"><span><strong>2. <code>vcpkg</code>（包管理）</strong></span></a></h4><ul><li><strong>作用</strong>：集成第三方库（如 OpenSSL、Boost）。</li><li><strong>示例</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装库并集成到项目</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vcpkg</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zlib:x64-windows</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-dumpbin-exe-查看二进制信息" tabindex="-1"><a class="header-anchor" href="#_3-dumpbin-exe-查看二进制信息"><span><strong>3. <code>dumpbin.exe</code>（查看二进制信息）</strong></span></a></h4><ul><li><strong>作用</strong>：分析可执行文件或库的符号、依赖项。</li><li><strong>示例</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 DLL 的导出函数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dumpbin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /exports</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MyLibrary.dll</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span><strong>总结</strong></span></a></h3><p>通过上述命令，可以在 <strong>Visual Studio</strong> 环境中实现高效的项目构建与管理。掌握 <code>MSBuild</code>、<code>cl.exe</code> 和 <code>link.exe</code> 的核心用法，能够灵活应对从简单编译到复杂项目构建的需求，同时结合 <code>Developer Command Prompt</code> 的环境配置，确保编译链接过程无缝衔接。</p><h2 id="windows下-ulonglong-dword-word-byte-分别是多少字节" tabindex="-1"><a class="header-anchor" href="#windows下-ulonglong-dword-word-byte-分别是多少字节"><span>windows下 ULONGLONG DWORD WORD BYTE 分别是多少字节？</span></a></h2><p>在 Windows 平台下，以下数据类型的大小如下：</p><table><thead><tr><th><strong>数据类型</strong></th><th><strong>字节数</strong></th><th><strong>位数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>BYTE</strong></td><td>1 字节</td><td>8 位</td><td>无符号字符类型，等同于 <code>unsigned char</code>。</td></tr><tr><td><strong>WORD</strong></td><td>2 字节</td><td>16 位</td><td>无符号短整数类型，等同于 <code>unsigned short</code>。</td></tr><tr><td><strong>DWORD</strong></td><td>4 字节</td><td>32 位</td><td>&quot;双字&quot;（Double Word），等同于 <code>unsigned long</code>（注意：在 Windows 中始终为 4 字节）。</td></tr><tr><td><strong>ULONGLONG</strong></td><td>8 字节</td><td>64 位</td><td>无符号长长整数类型，等同于 <code>unsigned long long</code>（C++11 中的 <code>uint64_t</code>）。</td></tr></tbody></table><hr><h3 id="关键说明" tabindex="-1"><a class="header-anchor" href="#关键说明"><span>关键说明：</span></a></h3><ol><li><p><strong>固定大小</strong>：<br> 这些类型在 Windows SDK 中明确定义，与编译器和系统架构（32/64位）无关，保证兼容性。</p></li><li><p><strong>用途</strong>：</p><ul><li><code>BYTE</code>：处理二进制数据（如文件、网络流）。</li><li><code>WORD</code>/<code>DWORD</code>：与 Windows API 交互（如 <code>GetLastError()</code> 返回 <code>DWORD</code>）。</li><li><code>ULONGLONG</code>：表示大范围数值（如文件大小、时间戳）。</li></ul></li><li><p><strong>跨平台注意</strong>：<br> 非 Windows 系统（如 Linux）需使用 <code>&lt;stdint.h&gt;</code> 的类型（如 <code>uint32_t</code>），但 Windows 下优先使用上述类型以保证与 API 兼容。</p></li></ol><hr><h3 id="验证方式" tabindex="-1"><a class="header-anchor" href="#验证方式"><span>验证方式：</span></a></h3><p>可通过 <code>sizeof</code> 运算符直接验证（示例代码）：</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;Windows.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;BYTE: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%zu</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(BYTE));</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      // 输出 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;WORD: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%zu</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(WORD));</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      // 输出 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;DWORD: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%zu</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(DWORD));</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 输出 4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ULONGLONG: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%zu</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ULONGLONG));</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 输出 8</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,328)]))}const d=s(h,[["render",e],["__file","The-core-principles-of-reverse-engineering.html.vue"]]),r=JSON.parse('{"path":"/public-articles/The-core-principles-of-reverse-engineering.html","title":"逆向工程核心原理","lang":"zh-CN","frontmatter":{"description":"逆向工程核心原理 那么，读者应该如何使用本书学习逆向分析技术呢？对此，我给出如下几点建议，供各位参考。 第一，技术书不是装饰书架的道具，它们是提高各位技术水平的工具。所以阅读时要勾画出重要部分，在书页空白处写下自己的想法与心得等。阅读时，在书页上记录相关技术、注意事项、技术优缺点、与作者的不同见解等，让它成为只属于你的书。读完这样一本逆向分析技术书后，...","head":[["meta",{"property":"og:url","content":"https://github.com/biezhihua/public-articles/The-core-principles-of-reverse-engineering.html"}],["meta",{"property":"og:site_name","content":"biezhihua的日常"}],["meta",{"property":"og:title","content":"逆向工程核心原理"}],["meta",{"property":"og:description","content":"逆向工程核心原理 那么，读者应该如何使用本书学习逆向分析技术呢？对此，我给出如下几点建议，供各位参考。 第一，技术书不是装饰书架的道具，它们是提高各位技术水平的工具。所以阅读时要勾画出重要部分，在书页空白处写下自己的想法与心得等。阅读时，在书页上记录相关技术、注意事项、技术优缺点、与作者的不同见解等，让它成为只属于你的书。读完这样一本逆向分析技术书后，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-10T15:06:41.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-10T15:06:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"逆向工程核心原理\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-10T15:06:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"别志华\\",\\"url\\":\\"https://github.com/biezhihua\\"}]}"]]},"git":{"createdTime":1738931457000,"updatedTime":1741619201000,"contributors":[{"name":"biezhihua","username":"biezhihua","email":"biezhihua@gmail.com","commits":14,"url":"https://github.com/biezhihua"}]},"readingTime":{"minutes":41.53,"words":12460},"filePathRelative":"public-articles/The-core-principles-of-reverse-engineering.md","localizedDate":"2025年2月7日","excerpt":"","autoDesc":true}');export{d as comp,r as data};
